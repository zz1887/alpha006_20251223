# alpha_pluse因子 - 因子字典

**文档版本**: v1.0
**创建日期**: 2025-12-29
**因子类型**: 动量因子 (成交量异常放量信号)

---

## 因子概述

### 基本信息
| 项目 | 内容 |
|------|------|
| **因子名称** | `alpha_pluse` |
| **因子类型** | 动量因子（成交量异常放量） |
| **计算频率** | 日频 |
| **数据更新** | T+1（每日收盘后） |
| **因子值域** | 0 或 1 (二元变量) |
| **标准化** | 不需要 |

### 因子定义
**构造规则**:
每个交易日T往前20个交易日内，统计满足「t日交易量=其往前14日均值的1.4-3.5倍」的交易日数量

**赋值规则**:
- 数量在2-4个（含）则 T日 `alpha_pluse = 1`
- 否则 `alpha_pluse = 0`

---

## 计算公式

### 核心公式
```
# 1. 计算14日成交量均值
vol_14_mean(t) = mean(vol(t-13), vol(t-12), ..., vol(t))

# 2. 判断单日是否满足条件
condition(t) = 1.4 ≤ vol(t) / vol_14_mean(t) ≤ 3.5

# 3. 统计20日内满足条件的数量
count_20d(T) = sum(condition(T-19), condition(T-18), ..., condition(T))

# 4. 赋值
alpha_pluse(T) = 1  if 2 ≤ count_20d(T) ≤ 4
               = 0  otherwise
```

### 计算步骤详解

**对每个交易日T**:

1. **回溯窗口**: 获取T-19到T（共20天）的交易数据
2. **计算均值**: 对窗口内每个交易日t，计算其前14日成交量均值
   - 需要t-13到t的14天数据
   - 因此实际需要T-32到T的数据才能计算T日因子
3. **判断条件**: 检查t日成交量是否在1.4-3.5倍范围内
4. **统计数量**: 计算20日内满足条件的天数
5. **赋值**: 根据数量范围确定因子值

---

## 数据来源

### 输入数据
| 数据项 | 表名 | 字段名 | 数据类型 | 说明 |
|--------|------|--------|----------|------|
| 成交量 | `daily_kline` | `vol` | decimal | 日成交量（手）|

### 数据要求
- **最小数据量**: 需要至少32个交易日的历史数据才能计算首个因子值
- **数据质量**: 成交量必须为正数，不能为NULL
- **时间范围**: 建议至少6个月以上历史数据用于回测

---

## 参数配置

### 标准参数
```python
{
    'window_20d': 20,      # 回溯窗口
    'lookback_14d': 14,    # 成交量均值计算周期
    'lower_mult': 1.4,     # 下限倍数
    'upper_mult': 3.5,     # 上限倍数
    'min_count': 2,        # 最小满足数量
    'max_count': 4         # 最大满足数量
}
```

### 参数说明
| 参数 | 默认值 | 说明 |
|------|--------|------|
| `window_20d` | 20 | 统计满足条件的回溯天数 |
| `lookback_14d` | 14 | 计算成交量均值的天数 |
| `lower_mult` | 1.4 | 成交量放大倍数下限 |
| `upper_mult` | 3.5 | 成交量放大倍数上限 |
| `min_count` | 2 | 触发信号的最小满足天数 |
| `max_count` | 4 | 触发信号的最大满足天数 |

---

## 因子含义

### 信号解读
`alpha_pluse = 1` 表示:
- **近期放量**: 20日内有2-4天出现显著放量
- **适度活跃**: 放量天数适中，不是偶然波动
- **持续关注**: 可能预示资金持续流入或市场关注度提升

### 逻辑基础
1. **放量标准**: 1.4-3.5倍于14日均值
   - 1.4倍: 显著放量，排除日常波动
   - 3.5倍: 极端放量，避免过度异常

2. **数量范围**: 2-4天
   - 2天: 确认不是单日偶然
   - 4天: 避免过度交易或持续放量

3. **20日窗口**: 平衡时效性和稳定性

---

## 异常值处理

### 数据验证
| 异常类型 | 判定条件 | 处理方式 |
|----------|----------|----------|
| 成交量空值 | `vol IS NULL` | 跳过该日 |
| 成交量为零 | `vol <= 0` | 跳过该日 |
| 数据不足 | 历史数据 < 32天 | 不计算因子 |

### 计算窗口处理
- 前13天: 无法计算14日均值，跳过
- 第14-19天: 可计算均值但不足20日窗口，跳过
- 第20天起: 开始计算因子

---

## 适用场景

### 推荐使用场景
| 场景 | 说明 | 使用建议 |
|------|------|----------|
| **短线交易** | 捕捉放量启动信号 | alpha_pluse=1时关注 |
| **动量策略** | 结合价格趋势使用 | 作为动量确认指标 |
| **资金流向** | 识别资金活跃股票 | 放量天数反映资金关注 |
| **事件驱动** | 捕捉信息反应 | 事件后放量持续性 |

### 不适用场景
- **长期投资**: 因子偏短期信号
- **低波动股票**: 成交量变化小，信号少
- **高换手股票**: 可能频繁触发，噪音多

---

## 策略应用

### 基础策略
```python
# 买入条件
if alpha_pluse == 1:
    # 有放量信号，关注或买入
    signal = 1

# 持有/卖出
if alpha_pluse == 0:
    # 无放量信号，观望或卖出
    signal = 0
```

### 进阶策略
1. **结合价格趋势**
   ```
   买入: alpha_pluse=1 AND 价格突破N日高点
   ```

2. **结合动量指标**
   ```
   买入: alpha_pluse=1 AND RSI < 70
   ```

3. **多因子合成**
   ```
   综合得分 = w1*alpha_pluse + w2*momentum + w3*valuation
   ```

---

## 代码实现

### 使用示例
```python
from factors.momentum.factor_alpha_pluse import AlphaPluseFactor, create_factor

# 1. 创建因子计算器
factor = create_factor('standard')  # 标准版

# 2. 按时间段计算
result = factor.calculate_by_period(
    start_date='20250101',
    end_date='20250331'
)

# 3. 查看统计
stats = factor.get_factor_stats(result)
print(stats)

# 4. 获取每日统计
daily = factor.get_daily_stats(result)
print(daily)

# 5. 查看个股详情
detail = factor.get_detail_by_stock(result, '000001.SZ')
print(detail)
```

### 输出字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| `ts_code` | str | 股票代码 |
| `trade_date` | datetime | 交易日期 |
| `alpha_pluse` | int | 因子值 (0或1) |
| `count_20d` | float | 20日内满足条件的数量 |

### 可选字段（详细模式）
| 字段名 | 类型 | 说明 |
|--------|------|------|
| `vol` | float | 当日成交量 |
| `vol_14_mean` | float | 14日成交量均值 |
| `condition` | bool | 当日是否满足条件 |

---

## 版本配置

### 因子版本
```python
FACTOR_VERSIONS = {
    'standard': {      # 标准版
        'window_20d': 20,
        'lookback_14d': 14,
        'lower_mult': 1.4,
        'upper_mult': 3.5,
        'min_count': 2,
        'max_count': 4,
    },
    'conservative': {  # 保守版 - 更严格
        'lower_mult': 1.5,
        'upper_mult': 3.0,
        'min_count': 3,
        'max_count': 4,
    },
    'aggressive': {    # 激进版 - 更宽松
        'lower_mult': 1.3,
        'upper_mult': 4.0,
        'min_count': 2,
        'max_count': 5,
    },
}
```

---

## 验证方法

### 快速验证
```bash
python /home/zcy/alpha006_20251223/code/verify_alpha_pluse.py
```

### 详细测试
```bash
python /home/zcy/alpha006_20251223/code/test_alpha_pluse.py
```

### 预期结果
使用样本数据验证:
- 股票A (3天满足): alpha_pluse = 1 ✅
- 股票B (1天满足): alpha_pluse = 0 ✅
- 股票C (5天满足): alpha_pluse = 0 ✅
- 股票D (2天满足): alpha_pluse = 1 ✅

---

## 注意事项

### 计算要点
1. **数据完整性**: 确保有足够的历史数据（至少32天）
2. **时间对齐**: 交易日必须连续，跳过停牌日
3. **计算顺序**: 先计算14日均值，再判断条件，最后统计

### 使用建议
1. **避免单独使用**: 建议结合其他因子或指标
2. **注意市场环境**: 不同市场环境下信号有效性可能不同
3. **回测验证**: 实际使用前务必进行充分回测
4. **参数优化**: 可根据具体策略调整参数

### 常见问题
**Q: 为什么需要32天历史数据？**
A: 14日均值需要14天 + 20日窗口需要20天 = 34天，但可以重叠计算，实际需要32天。

**Q: 为什么倍数范围是1.4-3.5？**
A: 1.4倍确保显著放量，3.5倍避免极端异常值。

**Q: 为什么数量范围是2-4？**
A: 2天确认非偶然，4天避免过度活跃。

---

## 更新日志

| 版本 | 日期 | 变更说明 |
|------|------|----------|
| 1.0 | 2025-12-29 | 初始版本，完成因子设计和实现 |

---

## 相关文档

- [因子索引](FACTOR_INDEX.md)
- [数据处理工具](../core/utils/data_processor.py)
- [因子实现代码](../factors/momentum/factor_alpha_pluse.py)
- [测试脚本](../code/verify_alpha_pluse.py)

---

**文档维护**: Alpha006项目组
**最后更新**: 2025-12-29
