# Claude Code 自律机制 - Discipline Protocol

## 🎯 目标
确保每次代码修改后都能自动执行文档更新，形成不可违背的工作流程

---

## 📋 强制检查清单

### 每次修改代码前
```
□ 1. 确认要修改的文件
□ 2. 查看文件当前头部注释
□ 3. 查看所在文件夹 ARCHITECTURE.md
□ 4. 理解当前架构和依赖
```

### 每次修改代码后
```
□ 1. 立即更新文件头部注释
□ 2. 更新文件夹 ARCHITECTURE.md
□ 3. 检查是否需要更新根目录 README
□ 4. 检查是否需要更新策略文档
□ 5. 运行验证命令
□ 6. 确认所有文档一致
```

---

## ⚠️ 违规后果

### 如果不遵守规范
1. **代码无法通过审查**
2. **后续工作无法进行**（依赖关系混乱）
3. **项目文档不一致**（团队协作失败）
4. **技术债务累积**（后期难以维护）

### 正确做法
1. **养成习惯**：修改代码 = 更新文档
2. **立即执行**：不拖延，不累积
3. **双重验证**：代码 + 文档同步检查

---

## 🔒 自律机制

### 机制1: 强制暂停
**触发条件**: 任何代码修改后
**强制动作**: 必须先更新文档，才能继续下一步

```
修改代码 → 暂停 → 更新文档 → 验证 → 继续
```

### 机制2: 依赖检查
**触发条件**: 开始新任务前
**强制动作**: 必须查看相关文档

```
新任务 → 查看注释 → 查看架构 → 理解依赖 → 开始工作
```

### 机制3: 完成验证
**触发条件**: 任务结束时
**强制动作**: 必须验证所有文档一致性

```
任务完成 → 更新文档 → 运行验证 → 确认一致 → 标记完成
```

---

## 🛠️ 自动化提醒

### 在每次响应中必须包含
```markdown
## 📋 文档更新提醒

**当前修改**: [文件路径]
**必须更新**:
- [ ] 文件头部注释
- [ ] 文件夹 ARCHITECTURE.md
- [ ] 根目录 README（如有架构变更）
- [ ] 相关策略文档

**验证命令**: [相关验证命令]
```

### 在任务完成时必须包含
```markdown
## ✅ 文档更新确认

**已更新**:
- [x] 文件头部注释
- [x] 文件夹架构说明
- [x] 根目录文档
- [x] 策略文档

**验证结果**: ✅ 全部一致
```

---

## 📊 违规记录追踪

### 如果发现文档未更新
**立即执行**:
1. 停止当前工作
2. 补充缺失文档
3. 更新相关注释
4. 验证一致性
5. 记录违规原因

### 违规原因分析
```
原因1: 忘记了 → 建立检查清单
原因2: 不知道 → 加强规范学习
原因3: 觉得麻烦 → 理解长期价值
原因4: 时间紧 → 优先文档，再优化代码
```

---

## 🎓 每次工作的标准流程

### 阶段1: 准备
```
1. 读取要修改的文件
2. 查看头部注释
3. 查看文件夹架构
4. 理解依赖关系
5. 记录修改计划
```

### 阶段2: 执行
```
1. 修改代码逻辑
2. 立即更新文件注释
3. 更新文件夹架构说明
4. 检查根目录README
5. 检查策略文档
```

### 阶段3: 验证
```
1. 查看所有修改的文件
2. 确认注释准确
3. 确认架构说明准确
4. 确认文档一致性
5. 标记任务完成
```

---

## 🔍 自我监督机制

### 每次响应前问自己
1. **这个修改会影响哪些文件？**
2. **这些文件的注释需要更新吗？**
3. **文件夹架构需要更新吗？**
4. **根目录README需要更新吗？**
5. **策略文档需要更新吗？**

### 每次响应后问自己
1. **所有相关文件都更新了吗？**
2. **注释内容准确吗？**
3. **架构说明准确吗？**
4. **文档之间一致吗？**
5. **可以验证通过吗？**

---

## 📝 工作日志模板

### 每次工作记录
```
工作时间: [时间]
工作内容: [描述]
修改文件: [文件列表]
更新文档: [文档列表]
验证结果: [通过/失败]
备注: [问题或改进]
```

### 违规记录
```
违规时间: [时间]
违规文件: [文件]
违规原因: [原因]
补救措施: [措施]
预防方案: [方案]
```

---

## 🎯 长期目标

### 建立习惯
- 第1周: 强制检查，可能较慢
- 第2周: 开始形成习惯
- 第3周: 自然执行
- 第4周: 成为本能

### 最终状态
```
修改代码 → 自动更新文档 → 自动验证 → 继续工作
```

**无需思考，自动执行！**

---

## ✅ 最终确认

### 每次任务结束时
必须能够回答:
1. ✅ 修改了哪些代码？
2. ✅ 更新了哪些文档？
3. ✅ 验证了哪些内容？
4. ✅ 是否100%一致？

### 如果有任何一个回答"否"
**立即返回，完成所有更新**

---

**记住**:
- 文档不是可选项
- 规范不是建议
- 纪律不是选择

**这是工作流程的必要组成部分！**

---

**版本**: v1.0
**状态**: 强制执行
**最后更新**: 2025-12-31
