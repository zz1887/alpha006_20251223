# alpha_peg因子回测对比分析报告

## 📊 执行概览

**回测时间**: 2026-01-04
**回测周期**: 20250101 - 20251101
**调仓频率**: 月度
**对比方案**: 2种不同零值处理策略

---

## 🔧 两种策略对比

### 策略A: 负值置0（Modified）
```python
# 规则
if pe_ttm ≤ 0 or dt_netprofit_yoy ≤ 0:
    alpha_peg = 0
else:
    alpha_peg = pe_ttm / dt_netprofit_yoy

# 分组
所有值一起分5组（包含大量零值）
```

### 策略B: 排除零值（Exclude Zero）
```python
# 规则（同策略A）
if pe_ttm ≤ 0 or dt_netprofit_yoy ≤ 0:
    alpha_peg = 0
else:
    alpha_peg = pe_ttm / dt_netprofit_yoy

# 分组改进
非零值分4组 + 零值单独组5
```

---

## 📈 回测结果对比

### 收益表现（累计收益）

| 分组 | 策略A: Modified | 策略B: Exclude Zero | 变化 |
|------|----------------|---------------------|------|
| **组1** | **6.75%** | **6.91%** | +0.16% ✅ |
| 组2 | 6.86% | 4.06% | -2.80% |
| 组3 | 3.84% | 6.10% | +2.26% |
| 组4 | 0.94% | 6.24% | +5.30% |
| 组5 | 0.00% | 8.38% | +8.38% |

### 因子指标

| 指标 | 策略A: Modified | 策略B: Exclude Zero | 变化 |
|------|----------------|---------------------|------|
| IC均值 | -0.0569 | -0.0569 | 无变化 |
| ICIR | -0.7581 | -0.7581 | 无变化 |

---

## 🔍 单调性分析

### 策略A: Modified
```
组1: 6.75% ✓
组2: 6.86% ✗ (反常，高于组1)
组3: 3.84% ✓
组4: 0.94% ✓
组5: 0.00% ✓
```
**结论**: ❌ 单调性失败（组2 > 组1）

### 策略B: Exclude Zero
```
组1: 6.91% ✓
组2: 4.06% ✗ (反常，低于组3)
组3: 6.10% ✗ (反常，高于组2)
组4: 6.24% ✗ (反常，高于组3)
组5: 8.38% ✗ (反常，最高)
```
**结论**: ❌ 单调性完全失败

---

## 📊 深度分析

### 问题根源：零值占比过高

根据测试分析（2025-10-31数据）：
```
总样本: ~2,500只股票
零值: ~1,100只 (44.1%)
非零值: ~1,400只 (55.9%)
```

### 策略A的问题
**分组分布**:
- 组1-4都包含大量零值
- 组1和组2的零值比例相近 → 收益相近
- 因子无法有效区分"好"和"坏"

**数据验证**:
```python
# 假设各组零值比例
组1: 30% 零值
组2: 25% 零值 (略低，可能表现更好)
组3: 40% 零值
组4: 50% 零值
组5: 70% 零值
```

### 策略B的问题
**分组分布**:
- 组1-4: 仅非零值分组
- 组5: 全部零值

**问题分析**:
1. **组5收益最高 (8.38%)**: 零值股票反而表现最好？
   - 可能原因：零值代表某些特殊类型股票（亏损、ST等），在特定市场环境下表现
   - 或：零值股票数量少，个别股票大幅上涨拉高平均

2. **组2、3、4混乱**: 非零值分组后单调性仍失败
   - 可能原因：因子本身区分度不足
   - 或：2025年市场风格与因子预期相反

---

## 🎯 因子特性诊断

### 核心问题

1. **零值占比过高 (44%)**
   - 大量样本无法计算有效因子值
   - 严重影响因子区分度

2. **因子定义问题**
   ```
   alpha_peg = pe_ttm / dt_netprofit_yoy
   ```
   - 分母为增长率，可正可负
   - 负增长导致因子值为负
   - 负值置0后，因子值域: [0, ∞)

3. **值域分布不均**
   - 0值: 44%
   - 正值: 56%
   - 缺乏负值，无法形成完整分布

---

## 💡 改进建议

### 方案1: 重新定义因子（推荐）

```python
# 使用增长率绝对值
if pe_ttm <= 0 or dt_netprofit_yoy <= 0:
    alpha_peg = np.nan  # 排除
else:
    alpha_peg = pe_ttm / abs(dt_netprofit_yoy)
```

**预期效果**:
- 消除负值问题
- 保持因子单调性
- 减少零值比例

### 方案2: 行业中性化

```python
# 行业调整
df['alpha_peg_neutral'] = df['alpha_peg'] - industry_median
```

**预期效果**:
- 消除行业偏差
- 提高因子IC

### 方案3: 结合其他因子

```python
# 多因子组合
score = 0.5 * alpha_peg + 0.3 * alpha_pb + 0.2 * alpha_roe
```

**预期效果**:
- 提高区分度
- 降低单一因子风险

---

## 📋 配置参数回顾

```python
{
    'start_date': '20250101',
    'end_date': '20251101',
    'rebalance_freq': 'monthly',
    'quantiles': 5,
    'min_stocks': 5,
    'commission': 0.0005,
    'stamp_tax': 0.001,
    'slippage': 0.001,
    'total_cost': 0.0025
}
```

**调仓日期**:
```
20250127, 20250228, 20250331, 20250430, 20250530,
20250630, 20250731, 20250829, 20250930, 20251031
```

---

## 📁 结果文件

### 策略A: Modified
```
results/backtest/
├── alpha_peg_modified_20250101_20251101_20260104_131525_summary.csv
├── alpha_peg_modified_20250101_20251101_20260104_131525_quantiles.csv
├── alpha_peg_modified_20250101_20251101_20260104_131525_ic.csv
└── alpha_peg_modified_20250101_20251101_20260104_131525_details.csv
```

### 策略B: Exclude Zero
```
results/backtest/
└── alpha_peg_exclude_zero_20250101_20251101_20260104_131923_summary.csv
```

---

## 🎯 结论与行动建议

### 当前状态总结

| 维度 | 评估 | 说明 |
|------|------|------|
| 因子方向 | ✅ 正确 | IC为负，符合负向因子预期 |
| 收益能力 | ⚠️ 一般 | 组1有6.9%收益，但单调性失败 |
| 因子稳定性 | ⚠️ 偏弱 | ICIR = -0.76，小于1 |
| 单调性 | ❌ 失败 | 两种策略均未实现单调 |

### 根本原因
**零值占比过高 (44%) + 因子定义缺陷**

### 立即行动
1. ✅ **已完成**: 两种策略对比分析
2. ⚠️ **待优化**: 尝试方案1（使用绝对值）
3. 🔄 **后续**: 行业中性化测试

### 推荐下一步
```python
# 新版本因子定义
def calculate_alpha_peg_v3(df):
    # 1. 排除无效数据
    mask = (df['pe_ttm'] > 0) & (df['dt_netprofit_yoy'] != 0)
    df = df[mask].copy()

    # 2. 使用绝对值
    df['alpha_peg'] = df['pe_ttm'] / abs(df['dt_netprofit_yoy'])

    # 3. 去极值
    df['alpha_peg'] = clip_outliers(df['alpha_peg'])

    return df
```

---

## 📊 关键数据速查

### 策略A: Modified
- 组1收益: 6.75%
- 组5收益: 0.00%
- IC均值: -0.0569
- ICIR: -0.7581

### 策略B: Exclude Zero
- 组1收益: 6.91%
- 组5收益: 8.38% (异常)
- IC均值: -0.0569
- ICIR: -0.7581

### 零值统计
- 占比: 44.1%
- 来源: pe≤0 或 增长率≤0
- 影响: 严重破坏单调性

---

**报告生成时间**: 2026-01-04
**回测版本**: alpha_peg v2.0 对比分析
**分析师**: Alpha006项目组

---

## 📌 附录：IC序列对比

### 策略A: Modified
```
20250228: -0.2436
20250331: -0.0410
20250430: -0.0002
20250530: -0.0337
20250630: +0.0018 (正向)
20250731: -0.0762
20250829: -0.0550
20250930: -0.0076
```

### 策略B: Exclude Zero
IC值相同（因子计算一致）

**观察**: 6月份IC为正，因子方向短暂失效

---

**结论**: 需要重新设计因子定义，解决零值占比过高问题，才能改善单调性。