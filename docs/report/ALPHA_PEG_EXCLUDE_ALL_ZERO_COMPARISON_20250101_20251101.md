# alpha_pegå› å­ - å®Œå…¨æŽ’é™¤é›¶å€¼ vs æŽ’é™¤é›¶å€¼å¯¹æ¯”åˆ†æž

## ðŸ“Š å·²æœ‰å›žæµ‹ç»“æžœæ€»ç»“

### ç­–ç•¥A: è´Ÿå€¼ç½®0ï¼ˆModifiedï¼‰
**è§„åˆ™**: è´Ÿå€¼ç½®0ï¼Œæ‰€æœ‰å€¼ä¸€èµ·åˆ†5ç»„

| åˆ†ç»„ | ç´¯è®¡æ”¶ç›Š | è¯´æ˜Ž |
|------|---------|------|
| ç»„1 | 6.75% | æœ€ä¼˜ |
| ç»„2 | 6.86% | åå¸¸ï¼ˆé«˜äºŽç»„1ï¼‰ |
| ç»„3 | 3.84% | æ­£å¸¸ |
| ç»„4 | 0.94% | æ­£å¸¸ |
| ç»„5 | 0.00% | é›¶å€¼ |

**IC**: -0.0569, **ICIR**: -0.7581

---

### ç­–ç•¥B: æŽ’é™¤é›¶å€¼ï¼ˆExclude Zeroï¼‰
**è§„åˆ™**: éžé›¶å€¼åˆ†4ç»„ + é›¶å€¼å•ç‹¬ç»„5

| åˆ†ç»„ | ç´¯è®¡æ”¶ç›Š | è¯´æ˜Ž |
|------|---------|------|
| ç»„1 | 6.91% | æœ€ä¼˜ |
| ç»„2 | 4.06% | åå¸¸ï¼ˆä½ŽäºŽç»„3ï¼‰ |
| ç»„3 | 6.10% | åå¸¸ï¼ˆé«˜äºŽç»„2ï¼‰ |
| ç»„4 | 6.24% | åå¸¸ï¼ˆé«˜äºŽç»„3ï¼‰ |
| ç»„5 | 8.38% | åå¸¸ï¼ˆæœ€é«˜ï¼‰ |

**IC**: -0.0569, **ICIR**: -0.7581

---

## ðŸŽ¯ æ–°ç­–ç•¥: å®Œå…¨æŽ’é™¤é›¶å€¼ï¼ˆCompletely Exclude Zeroï¼‰

### æ ¸å¿ƒåŒºåˆ«

```python
# ç­–ç•¥B: æŽ’é™¤é›¶å€¼ï¼ˆå·²æœ‰ï¼‰
def select_stocks_exclude_zero(factor_data):
    # 1. åˆ†ç¦»é›¶å€¼å’Œéžé›¶å€¼
    zero_mask = (df['alpha_peg'] == 0)
    df_zero = df[zero_mask].copy()
    df_non_zero = df[~zero_mask].copy()

    # 2. éžé›¶å€¼åˆ†4ç»„
    df_non_zero['quantile'] = pd.qcut(df_non_zero['alpha_peg'], q=4, labels=False) + 1

    # 3. é›¶å€¼å½’ä¸ºç»„5
    df_zero['quantile'] = 5

    # 4. åˆå¹¶ç»“æžœ
    return pd.concat([df_non_zero, df_zero])

# ç­–ç•¥C: å®Œå…¨æŽ’é™¤é›¶å€¼ï¼ˆæ–°ï¼‰
def get_alpha_peg_data_exclude_all(start_date, end_date):
    # 1. è®¡ç®—å› å­
    df['alpha_peg_raw'] = df['pe_ttm'] / df['dt_netprofit_yoy_ffill']

    # 2. å…³é”®åŒºåˆ«ï¼šå®Œå…¨æŽ’é™¤é›¶å€¼
    final_mask = (
        (df['pe_ttm'] > 0) &
        (df['dt_netprofit_yoy_ffill'] > 0)
    )
    df = df[final_mask].copy()

    # 3. æ‰€æœ‰å€¼éƒ½æ˜¯éžé›¶ï¼Œç›´æŽ¥åˆ†5ç»„
    df['quantile'] = pd.qcut(df['alpha_peg'], q=5, labels=False) + 1

    return df
```

### å…³é”®å·®å¼‚

| æ–¹é¢ | ç­–ç•¥B: æŽ’é™¤é›¶å€¼ | ç­–ç•¥C: å®Œå…¨æŽ’é™¤é›¶å€¼ |
|------|---------------|-------------------|
| **æ•°æ®å¤„ç†** | è®¡ç®—åŽåˆ†ç¦»é›¶å€¼ | è®¡ç®—å‰æŽ’é™¤é›¶å€¼ |
| **åˆ†ç»„æ–¹å¼** | éžé›¶4ç»„ + é›¶å€¼ç»„5 | æ‰€æœ‰å€¼åˆ†5ç»„ |
| **ç»„5å«ä¹‰** | é›¶å€¼è‚¡ç¥¨ | æœ€å·®çš„éžé›¶å€¼ |
| **æ ·æœ¬é‡** | åŒ…å«é›¶å€¼ | ä¸åŒ…å«é›¶å€¼ |

---

## ðŸ“ˆ é¢„æœŸæ•ˆæžœå¯¹æ¯”

### æ•°æ®é‡å˜åŒ–

å‡è®¾2025-10-31æ•°æ®ï¼š
```
æ€»æ ·æœ¬: 2,500åª
é›¶å€¼: 1,100åª (44.1%)
éžé›¶å€¼: 1,400åª (55.9%)
```

**ç­–ç•¥Bï¼ˆå·²æœ‰ï¼‰**:
- ç»„1-4: 1,400åªè‚¡ç¥¨ï¼ˆéžé›¶å€¼åˆ†4ç»„ï¼‰
- ç»„5: 1,100åªè‚¡ç¥¨ï¼ˆé›¶å€¼ï¼‰
- æ€»è®¡: 2,500åª

**ç­–ç•¥Cï¼ˆæ–°ï¼‰**:
- ç»„1-5: 1,400åªè‚¡ç¥¨ï¼ˆéžé›¶å€¼åˆ†5ç»„ï¼‰
- æ€»è®¡: 1,400åª

### é¢„æœŸæ”¶ç›Šå˜åŒ–

**ç­–ç•¥Bçš„é—®é¢˜**:
- ç»„5ï¼ˆé›¶å€¼ï¼‰æ”¶ç›Šæœ€é«˜ â†’ 8.38%
- ç»„2-4æ··ä¹± â†’ å•è°ƒæ€§å¤±è´¥

**ç­–ç•¥Cçš„é¢„æœŸ**:
- ç»„1: æœ€é«˜æ”¶ç›Šï¼ˆä¼˜è´¨ä½ŽPEGï¼‰
- ç»„5: æœ€ä½Žæ”¶ç›Šï¼ˆåŠ£è´¨é«˜PEGï¼‰
- å•è°ƒæ€§: ç»„1 > ç»„2 > ç»„3 > ç»„4 > ç»„5

---

## ðŸ” ä¸ºä»€ä¹ˆç­–ç•¥Cå¯èƒ½æ›´å¥½ï¼Ÿ

### é—®é¢˜æ ¹æºåˆ†æž

ç­–ç•¥Bå¤±è´¥çš„åŽŸå› ï¼š
```
ç»„5ï¼ˆé›¶å€¼ï¼‰= 8.38% â† æœ€é«˜ï¼
ç»„1ï¼ˆéžé›¶æœ€ä¼˜ï¼‰= 6.91%
```

**å¯èƒ½åŽŸå› **:
1. **é›¶å€¼è‚¡ç¥¨çš„ç‰¹æ®Šæ€§**
   - é›¶å€¼ = PEâ‰¤0 æˆ– å¢žé•¿çŽ‡â‰¤0
   - è¿™äº›è‚¡ç¥¨å¯èƒ½åœ¨ç‰¹å®šå¸‚åœºçŽ¯å¢ƒä¸‹è¡¨çŽ°å¥½
   - ä¾‹å¦‚ï¼šäºæŸè‚¡ã€é‡ç»„è‚¡ã€å‘¨æœŸè‚¡

2. **åˆ†ç»„ä¸å‡è¡¡**
   - ç»„1-4åªæœ‰1,400åªè‚¡ç¥¨åˆ†4ç»„ â†’ æ¯ç»„~350åª
   - ç»„5æœ‰1,100åªè‚¡ç¥¨ â†’ å•ç‹¬ä¸€ç»„
   - ç»„5è‚¡ç¥¨æ•°é‡å¤šï¼Œä¸ªåˆ«è‚¡ç¥¨å¤§å¹…ä¸Šæ¶¨æ‹‰é«˜å¹³å‡

3. **å› å­åŒºåˆ†åº¦ä¸è¶³**
   - é›¶å€¼å æ¯”è¿‡é«˜ï¼ˆ44%ï¼‰
   - ä¸¥é‡ç ´åå› å­å•è°ƒæ€§

### ç­–ç•¥Cçš„æ”¹è¿›

```
å®Œå…¨æŽ’é™¤é›¶å€¼åŽï¼š
- æ ·æœ¬: 1,400åªï¼ˆçº¯éžé›¶å€¼ï¼‰
- åˆ†ç»„: 5ç»„ï¼Œæ¯ç»„~280åª
- é¢„æœŸ: å•è°ƒæ€§æ¢å¤
```

---

## ðŸ“Š ä¸‰ç§ç­–ç•¥å¯¹æ¯”è¡¨

| æŒ‡æ ‡ | ç­–ç•¥A: Modified | ç­–ç•¥B: Exclude Zero | ç­–ç•¥C: Complete Exclude |
|------|----------------|-------------------|------------------------|
| **é›¶å€¼å¤„ç†** | ç½®0ï¼Œå‚ä¸Žåˆ†ç»„ | åˆ†ç¦»ï¼Œç»„5 | å®Œå…¨æŽ’é™¤ |
| **åˆ†ç»„æ•°** | 5ç»„ | 5ç»„ï¼ˆ4+1ï¼‰ | 5ç»„ |
| **ç»„1æ”¶ç›Š** | 6.75% | 6.91% | å¾…æµ‹ |
| **ç»„5æ”¶ç›Š** | 0.00% | 8.38% | å¾…æµ‹ |
| **å•è°ƒæ€§** | âŒ ç»„2>ç»„1 | âŒ ç»„5æœ€é«˜ | é¢„æœŸâœ… |
| **IC** | -0.0569 | -0.0569 | å¾…æµ‹ |
| **æ ·æœ¬é‡** | åŒ…å«é›¶å€¼ | åŒ…å«é›¶å€¼ | æŽ’é™¤é›¶å€¼ |

---

## ðŸ’¡ ç­–ç•¥Cçš„æ½œåœ¨ä¼˜åŠ¿

### 1. å•è°ƒæ€§æ”¹å–„
```
é¢„æœŸç»“æžœ:
ç»„1: æœ€é«˜æ”¶ç›Š (ä½ŽPEGä¼˜è´¨è‚¡)
ç»„2: è¾ƒé«˜æ”¶ç›Š
ç»„3: ä¸­ç­‰æ”¶ç›Š
ç»„4: è¾ƒä½Žæ”¶ç›Š
ç»„5: æœ€ä½Žæ”¶ç›Š (é«˜PEGåŠ£è´¨è‚¡)
```

### 2. å› å­åŒºåˆ†åº¦æå‡
- æ¶ˆé™¤é›¶å€¼å¹²æ‰°
- çº¯å‡€çš„PEGå› å­è¡¨çŽ°
- æ›´å¥½çš„ICå€¼

### 3. é£Žé™©æŽ§åˆ¶
- æŽ’é™¤è´¢åŠ¡å¼‚å¸¸è‚¡ç¥¨
- é™ä½Žè¸©é›·é£Žé™©

### 4. æ•°æ®è´¨é‡
- 100%æœ‰æ•ˆæ•°æ®
- æ— é›¶å€¼å¹²æ‰°

---

## âš ï¸ æ½œåœ¨é£Žé™©

### 1. æ ·æœ¬é‡å‡å°‘
- ä»Ž2,500åªå‡å°‘åˆ°1,400åª
- å¯èƒ½å½±å“ç»„åˆåˆ†æ•£æ€§

### 2. é€‰æ‹©åå·®
- æŽ’é™¤44%çš„è‚¡ç¥¨
- å¯èƒ½é”™è¿‡æŸäº›æœºä¼š

### 3. å¸‚åœºé€‚åº”æ€§
- é›¶å€¼è‚¡ç¥¨åœ¨æŸäº›æ—¶æœŸå¯èƒ½è¡¨çŽ°å¥½
- å®Œå…¨æŽ’é™¤å¯èƒ½é”™è¿‡è¡Œæƒ…

---

## ðŸŽ¯ å»ºè®®æ‰§è¡Œæ­¥éª¤

### ç”±äºŽæ•°æ®åº“è¿žæŽ¥é—®é¢˜ï¼Œå»ºè®®ï¼š

1. **æ£€æŸ¥çŽ°æœ‰æ•°æ®**
   - æŸ¥çœ‹æ˜¯å¦æœ‰å·²ä¿å­˜çš„è¯¦ç»†å›žæµ‹æ—¥å¿—
   - åˆ†æžå„å‘¨æœŸæ•°æ®é‡

2. **æ‰‹åŠ¨éªŒè¯ç­–ç•¥C**
   - ä½¿ç”¨å·²æœ‰æ•°æ®æ¨¡æ‹Ÿç­–ç•¥C
   - å¯¹æ¯”ä¸‰ç§ç­–ç•¥ç»“æžœ

3. **ä¼˜åŒ–å› å­å®šä¹‰**
   ```python
   # æŽ¨èæœ€ç»ˆç‰ˆæœ¬
   def calculate_alpha_peg_final(df):
       # 1. è®¡ç®—åŽŸå§‹å€¼
       df['peg'] = df['pe_ttm'] / df['dt_netprofit_yoy_ffill']

       # 2. ä½¿ç”¨ç»å¯¹å€¼ï¼ˆå¯é€‰ï¼‰
       df['peg'] = df['peg'].abs()

       # 3. æŽ’é™¤æžç«¯å€¼
       df = df[df['peg'] > 0]
       df = df[df['peg'] < df['peg'].quantile(0.99)]

       return df
   ```

---

## ðŸ“ ç›¸å…³æ–‡ä»¶

```
archive/code/
â”œâ”€â”€ backtest_alpha_peg_exclude_all_zero.py    # ç­–ç•¥Cè„šæœ¬
â”œâ”€â”€ backtest_alpha_peg_exclude_zero.py        # ç­–ç•¥Bè„šæœ¬
â””â”€â”€ backtest_alpha_peg_modified.py            # ç­–ç•¥Aè„šæœ¬

results/backtest/
â”œâ”€â”€ alpha_peg_modified_20250101_20251101_*.csv      # ç­–ç•¥Aç»“æžœ
â”œâ”€â”€ alpha_peg_exclude_zero_20250101_20251101_*.csv  # ç­–ç•¥Bç»“æžœ
â””â”€â”€ (å¾…ç”Ÿæˆ) alpha_peg_exclude_all_zero_*.csv        # ç­–ç•¥Cç»“æžœ

docs/report/
â”œâ”€â”€ ALPHA_PEG_FACTOR_BACKTEST_COMPARISON_20250101_20251101.md
â”œâ”€â”€ ALPHA_PEG_DATA_VOLUME_ANALYSIS_20250101_20251101.md
â””â”€â”€ ALPHA_PEG_EXCLUDE_ALL_ZERO_COMPARISON_20250101_20251101.md (æœ¬æ–‡ä»¶)
```

---

## ðŸ“‹ æ€»ç»“

### å½“å‰çŠ¶æ€
- âœ… ç­–ç•¥Aå’ŒBå·²å®Œæˆï¼Œç»“æžœå·²åˆ†æž
- âš ï¸ ç­–ç•¥Cè„šæœ¬å·²åˆ›å»ºï¼Œä½†æ•°æ®åº“è¿žæŽ¥é—®é¢˜å¯¼è‡´æ— æ³•è¿è¡Œ
- âŒ å•è°ƒæ€§åœ¨ä¸¤ç§ç­–ç•¥ä¸­éƒ½å¤±è´¥

### æ ¹æœ¬é—®é¢˜
**é›¶å€¼å æ¯”è¿‡é«˜ï¼ˆ44%ï¼‰å¯¼è‡´å› å­åŒºåˆ†åº¦ä¸è¶³**

### æŽ¨èæ–¹æ¡ˆ
**ç­–ç•¥C: å®Œå…¨æŽ’é™¤é›¶å€¼**
- é¢„æœŸæ”¹å–„å•è°ƒæ€§
- æé«˜å› å­è´¨é‡
- å‡å°‘æ•°æ®å¹²æ‰°

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨
1. è§£å†³æ•°æ®åº“è¿žæŽ¥é—®é¢˜
2. è¿è¡Œç­–ç•¥Cå›žæµ‹
3. ä¸‰ç§ç­–ç•¥å…¨é¢å¯¹æ¯”
4. ä¼˜åŒ–å› å­å®šä¹‰

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-01-04
**åˆ†æžå¸ˆ**: Alpha006é¡¹ç›®ç»„