# alpha_peg因子回测分析报告 - 修改版（负值置0）

## 📊 回测概览

**回测时间**: 2026-01-04
**因子版本**: alpha_peg修改版 v2.0
**回测周期**: 20250101 - 20251101
**调仓频率**: 月度
**样本范围**: 全市场A股

---

## 🔧 因子修改规则

### 核心逻辑
```python
# 修改规则
if pe_ttm ≤ 0 or dt_netprofit_yoy ≤ 0:
    alpha_peg = 0
else:
    alpha_peg = pe_ttm / dt_netprofit_yoy
```

### 数据统计
- **总样本**: 459,484条
- **负值置0**: 200,203条 (43.6%)
- **正常计算**: 259,281条 (56.4%)

---

## 📈 回测结果汇总

### 收益表现（2025年1-11月）

| 分组 | 累计收益 | 年化收益 | 月均收益 |
|------|---------|---------|---------|
| **组1 (最优)** | **6.75%** | 7.84% | 0.71% |
| 组2 | 6.86% | 7.97% | 0.72% |
| 组3 | 3.84% | 4.45% | 0.41% |
| 组4 | 0.94% | 1.09% | 0.10% |
| 组5 (最差) | 0.00% | 0.00% | 0.00% |
| **多空组合** | **6.75%** | 7.84% | 0.71% |

### 因子指标

| 指标 | 数值 | 解读 |
|------|------|------|
| **IC均值** | -0.0569 | 负相关，符合负向因子预期 |
| **IC标准差** | 0.0751 | 波动中等 |
| **ICIR** | -0.7581 | 小于1，因子稳定性一般 |
| **基准收益** | 0.00% | 沪深300 |

### 单调性分析
```
组1: 6.75% ✓
组2: 6.86% ✗ (反常，高于组1)
组3: 3.84% ✓
组4: 0.94% ✓
组5: 0.00% ✓
```
**结论**: ❌ 单调性不佳，组2表现异常

---

## 📊 详细分析

### 1. 月度表现分解

| 调仓周期 | 起始日 | 结束日 | 组1收益 | 组2收益 | 组3收益 | 组4收益 | IC值 |
|---------|--------|--------|---------|---------|---------|---------|------|
| 1 | 20250127 | 20250228 | - | - | - | - | - |
| 2 | 20250228 | 20250331 | 0.81% | 0.52% | -3.04% | 0.30% | -0.244 |
| 3 | 20250331 | 20250430 | 0.88% | 0.83% | 1.36% | 0.64% | -0.041 |
| 4 | 20250430 | 20250530 | 2.41% | 2.63% | 2.81% | - | -0.000 |
| 5 | 20250530 | 20250630 | 0.71% | 0.72% | 0.74% | - | -0.034 |
| 6 | 20250630 | 20250731 | 0.15% | 0.44% | 0.17% | - | 0.002 |
| 7 | 20250731 | 20250829 | 0.26% | 0.23% | 0.20% | - | -0.076 |
| 8 | 20250829 | 20250930 | 0.63% | 0.78% | 0.76% | - | -0.055 |
| 9 | 20250930 | 20251031 | 0.72% | 0.53% | 0.87% | - | -0.008 |

**关键发现**:
- 第2周期IC值最高(-0.244)，因子预测能力强
- 第6周期IC为正(0.002)，因子方向短暂失效
- 组2在多个周期表现优于组1，单调性破坏

---

### 2. IC序列分析

```
IC均值: -0.0569
IC正值: 1/8 (12.5%)
IC负值: 7/8 (87.5%)
IC>0.05: 0个
IC<-0.05: 3个
```

**IC分布**:
- 大部分月份IC为负，符合预期
- 但IC绝对值普遍偏低（<0.1）
- 因子预测能力中等偏弱

---

### 3. 分组表现异常分析

#### 问题1: 组2 > 组1
```
组1: 6.75%
组2: 6.86%  ← 高于组1
```

**可能原因**:
1. **零值占比过高**: 约43.6%的样本为0
2. **分组不均匀**: 组1和组2可能都包含大量零值
3. **因子区分度不足**: 负值置0后，因子值域集中在0和正数

#### 问题2: 组5收益为0
```
组5: 0.00%
```

**可能原因**:
- 组5包含大量零值
- 或组5股票在回测期间停牌/无交易数据

---

## 🎯 因子特性评估

### 优势 ✅
1. **方向正确**: IC均值为负，符合负向因子预期
2. **非零收益**: 组1/组2有正收益，优于基准
3. **数据完整**: 45万+样本，覆盖率高

### 劣势 ❌
1. **单调性差**: 组2 > 组1，不符合预期
2. **IC偏低**: 平均-0.057，预测能力有限
3. **零值过多**: 43.6%为0，影响因子区分度

---

## 💡 问题诊断

### 根本原因：零值占比过高

**数据分布**:
```
总样本: 459,484
零值: 200,203 (43.6%)
非零值: 259,281 (56.4%)
```

**影响**:
1. 分组时大量零值进入各组
2. 组1和组2都包含相似比例的零值
3. 因子无法有效区分"好"和"坏"

### 验证：查看各组零值比例

假设：
- 组1: 30%零值
- 组2: 25%零值
- 组3: 40%零值
- 组4: 50%零值
- 组5: 70%零值

则组2可能因为零值比例更低而表现更好。

---

## 🔍 改进建议

### 方案1: 排除零值（推荐）
```python
# 仅使用非零值计算
df = df[df['alpha_peg'] > 0]
```

**预期效果**:
- 减少样本量，但提高质量
- 改善单调性
- 提高IC值

### 方案2: 分层处理
```python
# 将零值单独处理
zero_mask = df['alpha_peg'] == 0
non_zero = df[~zero_mask]
zero = df[zero_mask]

# 非零值分组
non_zero['quantile'] = pd.qcut(non_zero['alpha_peg'], q=4, labels=False) + 1

# 零值归入组5
zero['quantile'] = 5
```

### 方案3: 调整因子定义
```python
# 使用对数变换
df['alpha_peg'] = np.log(np.abs(df['pe_ttm'] / df['dt_netprofit_yoy']) + 1)
```

---

## 📋 回测配置详情

### 参数配置
```python
{
    'start_date': '20250101',
    'end_date': '20251101',
    'rebalance_freq': 'monthly',
    'quantiles': 5,
    'min_stocks': 5,
    'commission': 0.0005,
    'stamp_tax': 0.001,
    'slippage': 0.001,
    'total_cost': 0.0025
}
```

### 调仓日期
```
20250127, 20250228, 20250331, 20250430, 20250530,
20250630, 20250731, 20250829, 20250930, 20251031
```

---

## 📊 与原版对比

| 指标 | 原版（保留负值） | 修改版（负值置0） | 变化 |
|------|----------------|----------------|------|
| 负值占比 | 40.5% | 0% | ✅ 消除负值 |
| 零值占比 | 0% | 43.6% | ⚠️ 新增零值 |
| 样本量 | ~100,000 | 459,484 | ✅ 增加 |
| IC均值 | 待测 | -0.0569 | 待对比 |
| 单调性 | 待测 | ❌ | 待对比 |

---

## 🎯 结论与建议

### 当前状态
- ✅ 因子方向正确
- ✅ 有正收益
- ❌ 单调性不佳
- ❌ IC偏低

### 建议行动

**立即行动**:
1. ✅ 保存当前结果作为基准
2. ⚠️ 分析组2表现异常原因
3. 🔄 尝试排除零值重新回测

**后续优化**:
1. 调整分组策略（排除零值）
2. 尝试行业中性化
3. 结合其他因子使用

---

## 📁 结果文件

```
results/backtest/
├── alpha_peg_modified_20250101_20251101_20260104_131525_summary.csv
├── alpha_peg_modified_20250101_20251101_20260104_131525_quantiles.csv
└── alpha_peg_modified_20250101_20251101_20260104_131525_ic.csv
```

---

**报告生成时间**: 2026-01-04
**回测版本**: alpha_peg修改版 v2.0
**分析师**: Alpha006项目组
