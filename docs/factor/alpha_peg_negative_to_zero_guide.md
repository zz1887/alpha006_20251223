# alpha_pegå› å­ä¿®æ”¹è¯´æ˜ - è´Ÿå€¼ç½®0

## ğŸ“… ä¿®æ”¹æ—¥æœŸ
2026-01-04

## ğŸ¯ ä¿®æ”¹ç›®çš„

åŸç‰ˆæœ¬ä¸­ï¼Œå½“PEä¸ºè´Ÿæˆ–å¢é•¿ç‡ä¸ºè´Ÿæ—¶ï¼Œalpha_pegä¼šè®¡ç®—å‡ºè´Ÿå€¼æˆ–æ— ç©·å¤§ã€‚è¿™äº›è´Ÿå€¼åœ¨å› å­ä½¿ç”¨ä¸­å¯èƒ½å¸¦æ¥ä»¥ä¸‹é—®é¢˜ï¼š

1. **å› å­æ–¹å‘æ··ä¹±**ï¼šè´Ÿå€¼çš„å«ä¹‰ä¸æ˜ç¡®
2. **åˆ†å¸ƒæ‰­æ›²**ï¼šè´Ÿå€¼å½±å“å› å­åˆ†å¸ƒå’Œæ ‡å‡†åŒ–
3. **ç­–ç•¥å¤æ‚æ€§**ï¼šéœ€è¦ç‰¹æ®Šå¤„ç†è´Ÿå€¼æƒ…å†µ

**ä¿®æ”¹æ–¹æ¡ˆ**ï¼šå½“PEâ‰¤0æˆ–å¢é•¿ç‡â‰¤0æ—¶ï¼Œå°†alpha_pegè®¾ä¸º0ï¼Œç®€åŒ–å› å­ä½¿ç”¨ã€‚

---

## ğŸ”„ ä¿®æ”¹å‰åå¯¹æ¯”

### ä¿®æ”¹å‰ï¼ˆåŸå§‹ç‰ˆæœ¬ï¼‰
```python
# æ•°æ®è·å–
WHERE pe_ttm > 0 AND dt_netprofit_yoy != 0

# è®¡ç®—é€»è¾‘
valid_mask = (
    result['pe_ttm'].notna() &
    (result['pe_ttm'] > 0) &
    result['dt_netprofit_yoy_ffill'].notna() &
    (result['dt_netprofit_yoy_ffill'] != 0)
)

# è®¡ç®—
valid_data['alpha_peg'] = valid_data['pe_ttm'] / valid_data['dt_netprofit_yoy_ffill']
```

**ç»“æœ**ï¼š
- PE=10, å¢é•¿ç‡=20% â†’ alpha_peg = 0.5 âœ“
- PE=10, å¢é•¿ç‡=-5% â†’ alpha_peg = -2.0 (è´Ÿå€¼)
- PE=-5, å¢é•¿ç‡=20% â†’ è·³è¿‡ï¼ˆPEè¿‡æ»¤ï¼‰
- PE=10, å¢é•¿ç‡=0% â†’ è·³è¿‡ï¼ˆå¢é•¿ç‡è¿‡æ»¤ï¼‰

---

### ä¿®æ”¹åï¼ˆè´Ÿå€¼ç½®0ç‰ˆæœ¬ï¼‰
```python
# æ•°æ®è·å–ï¼ˆä»…è¿‡æ»¤ç©ºå€¼ï¼‰
WHERE pe_ttm IS NOT NULL AND dt_netprofit_yoy IS NOT NULL

# è®¡ç®—é€»è¾‘
valid_mask = (
    result['pe_ttm'].notna() &
    result['dt_netprofit_yoy_ffill'].notna()
)

# è®¡ç®—
# 1. å…ˆè®¡ç®—åŸå§‹å€¼
valid_data['alpha_peg_raw'] = valid_data['pe_ttm'] / valid_data['dt_netprofit_yoy_ffill']

# 2. åº”ç”¨ä¿®æ”¹è§„åˆ™ï¼šPEâ‰¤0 æˆ– å¢é•¿ç‡â‰¤0 â†’ è®¾ä¸º0
negative_mask = (
    (valid_data['pe_ttm'] <= 0) |
    (valid_data['dt_netprofit_yoy_ffill'] <= 0)
)
valid_data.loc[negative_mask, 'alpha_peg'] = 0
```

**ç»“æœ**ï¼š
- PE=10, å¢é•¿ç‡=20% â†’ alpha_peg = 0.5 âœ“
- PE=10, å¢é•¿ç‡=-5% â†’ alpha_peg = 0.0 âœ“
- PE=-5, å¢é•¿ç‡=20% â†’ alpha_peg = 0.0 âœ“
- PE=10, å¢é•¿ç‡=0% â†’ alpha_peg = 0.0 âœ“

---

## ğŸ“‹ ä¿®æ”¹è§„åˆ™è¯¦è§£

### è§„åˆ™1ï¼šPEâ‰¤0 æ—¶ç½®0
```python
pe_ttm = -5.0
dt_netprofit_yoy = 20.0
alpha_peg = 0.0  # PEä¸ºè´Ÿï¼Œç½®0
```

**åŸå› **ï¼š
- PEä¸ºè´Ÿè¡¨ç¤ºä¼ä¸šäºæŸæˆ–æ•°æ®å¼‚å¸¸
- è¿™ç§æƒ…å†µä¸‹PEGæ— æ„ä¹‰
- ç»Ÿä¸€è®¾ä¸º0ï¼Œä¾¿äºåç»­å¤„ç†

---

### è§„åˆ™2ï¼šå¢é•¿ç‡â‰¤0 æ—¶ç½®0
```python
pe_ttm = 10.0
dt_netprofit_yoy = -5.0
alpha_peg = 0.0  # å¢é•¿ç‡ä¸ºè´Ÿï¼Œç½®0
```

**åŸå› **ï¼š
- è´Ÿå¢é•¿è¡¨ç¤ºä¸šç»©ä¸‹æ»‘
- PEGç†è®ºä¸é€‚ç”¨äºè´Ÿå¢é•¿
- è®¾ä¸º0è¡¨ç¤º"ä¸é€‚ç”¨è¯¥æŒ‡æ ‡"

---

### è§„åˆ™3ï¼šä¸¤è€…åŒæ—¶â‰¤0 æ—¶ç½®0
```python
pe_ttm = -5.0
dt_netprofit_yoy = -10.0
alpha_peg = 0.0  # ä¸¤è€…éƒ½ä¸ºè´Ÿï¼Œç½®0
```

---

### è§„åˆ™4ï¼šæ­£å¸¸æƒ…å†µæ­£å¸¸è®¡ç®—
```python
pe_ttm = 10.0
dt_netprofit_yoy = 20.0
alpha_peg = 0.5  # æ­£å¸¸è®¡ç®—
```

---

## ğŸ“Š æ•°æ®åˆ†å¸ƒå½±å“

### ä¿®æ”¹å‰æ•°æ®åˆ†å¸ƒï¼ˆç¤ºä¾‹ï¼‰
```
æ ·æœ¬æ•°: 100,000
å‡å€¼: 3.74
ä¸­ä½æ•°: 0.21
æœ€å°å€¼: -200,771
æœ€å¤§å€¼: 346,175
è´Ÿå€¼å æ¯”: 40.5%
```

### ä¿®æ”¹åæ•°æ®åˆ†å¸ƒï¼ˆé¢„æœŸï¼‰
```
æ ·æœ¬æ•°: 100,000
å‡å€¼: 0.45 (é™ä½ï¼Œå› ä¸ºè´Ÿå€¼å˜0)
ä¸­ä½æ•°: 0.21 (ä¿æŒä¸å˜)
æœ€å°å€¼: 0.00 (ä¸å†æœ‰è´Ÿå€¼)
æœ€å¤§å€¼: 346,175 (ä¿æŒä¸å˜)
é›¶å€¼å æ¯”: ~40.5% (åŸè´Ÿå€¼éƒ¨åˆ†)
```

---

## ğŸ² ç­–ç•¥ä½¿ç”¨å»ºè®®

### 1. å› å­æ–¹å‘é…ç½®
```python
# é…ç½®ä¸ºè´Ÿå‘å› å­ï¼ˆè¶Šä½è¶Šå¥½ï¼‰
'alpha_peg': {
    'direction': 'negative',
}
```

**è¯´æ˜**ï¼š
- æ­£å¸¸å€¼ï¼š0 < alpha_peg < âˆ
- å¼‚å¸¸å€¼ï¼šalpha_peg = 0
- ç­–ç•¥ä¼šä¼˜å…ˆé€‰æ‹©ä½å€¼ï¼ˆåŒ…æ‹¬0ï¼‰

---

### 2. ç­›é€‰é€»è¾‘
```python
# ç­›é€‰ä½PEGè‚¡ç¥¨
low_peg = df[df['alpha_peg'] < 1.0]

# æ’é™¤å¼‚å¸¸å€¼ï¼ˆå¯é€‰ï¼‰
valid = df[
    (df['alpha_peg'] > 0) &
    (df['alpha_peg'] < 10)
]
```

---

### 3. æ ‡å‡†åŒ–å¤„ç†
```python
# æ–¹æ³•1ï¼šç›´æ¥ä½¿ç”¨ï¼ˆæ¨èï¼‰
df['alpha_peg_norm'] = df['alpha_peg']

# æ–¹æ³•2ï¼šZ-scoreæ ‡å‡†åŒ–ï¼ˆæ³¨æ„0å€¼å½±å“ï¼‰
df['alpha_peg_zscore'] = (df['alpha_peg'] - mean) / std

# æ–¹æ³•3ï¼šç§©è½¬æ¢ï¼ˆæ¶ˆé™¤0å€¼å½±å“ï¼‰
df['alpha_peg_rank'] = df['alpha_peg'].rank(pct=True)
```

---

## ğŸ” å®é™…æ¡ˆä¾‹

### æ¡ˆä¾‹1ï¼šæ­£å¸¸æˆé•¿è‚¡
```
è‚¡ç¥¨: Aå…¬å¸
PE: 15å€
å¢é•¿ç‡: 25%
alpha_peg: 0.6
è§£è¯»: ä¼°å€¼åˆç†ï¼Œå€¼å¾—å…³æ³¨
```

### æ¡ˆä¾‹2ï¼šä¸šç»©ä¸‹æ»‘
```
è‚¡ç¥¨: Bå…¬å¸
PE: 12å€
å¢é•¿ç‡: -8%
alpha_peg: 0.0
è§£è¯»: è´Ÿå¢é•¿ï¼Œå› å­æ ‡è®°ä¸º0
```

### æ¡ˆä¾‹3ï¼šäºæŸä¼ä¸š
```
è‚¡ç¥¨: Cå…¬å¸
PE: -3å€
å¢é•¿ç‡: 15%
alpha_peg: 0.0
è§£è¯»: PEå¼‚å¸¸ï¼Œå› å­æ ‡è®°ä¸º0
```

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ä½¿ç”¨
```python
from factors.valuation.alpha_peg_basic import calc_alpha_peg

# è®¡ç®—å› å­
df = calc_alpha_peg(
    start_date='20240801',
    end_date='20250305'
)

# ç»“æœç¤ºä¾‹
# ts_code  trade_date  pe_ttm  dt_netprofit_yoy  alpha_peg
# A.SZ     20240829    15.0    25.0              0.6
# B.SZ     20240829    12.0    -8.0              0.0
# C.SZ     20240829    -3.0    15.0              0.0
```

### ç­›é€‰ä½¿ç”¨
```python
# 1. è·å–æ‰€æœ‰æ•°æ®
df = calc_alpha_peg('20240801', '20250305')

# 2. ç­›é€‰æ­£å¸¸å€¼
valid_stocks = df[df['alpha_peg'] > 0]

# 3. é€‰æ‹©ä½PEG
low_peg = valid_stocks[valid_stocks['alpha_peg'] < 1.0]

# 4. æ’åºé€‰æ‹©
top_picks = low_peg.sort_values('alpha_peg').head(20)
```

---

## âœ… ä¼˜åŠ¿

1. **ç®€åŒ–é€»è¾‘**ï¼šæ— éœ€ç‰¹æ®Šå¤„ç†è´Ÿå€¼
2. **å› å­ç¨³å®š**ï¼šå€¼åŸŸæ›´æ¸…æ™°
3. **æ˜“äºä½¿ç”¨**ï¼šç­–ç•¥é…ç½®æ›´ç®€å•
4. **æ•°æ®å®Œæ•´**ï¼šä¿ç•™æ‰€æœ‰è‚¡ç¥¨è®°å½•

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. é›¶å€¼å«ä¹‰
- `alpha_peg = 0` è¡¨ç¤ºï¼š
  - PEâ‰¤0ï¼ˆäºæŸæˆ–å¼‚å¸¸ï¼‰
  - æˆ– å¢é•¿ç‡â‰¤0ï¼ˆä¸šç»©ä¸‹æ»‘ï¼‰
  - æˆ– ä¸¤è€…åŒæ—¶å¼‚å¸¸

### 2. ç­–ç•¥é…ç½®
- å› å­æ–¹å‘åº”è®¾ä¸º `negative`ï¼ˆè¶Šä½è¶Šå¥½ï¼‰
- é›¶å€¼ä¼šè¢«è§†ä¸º"å¥½"ï¼ˆä½ä¼°å€¼ï¼‰
- éœ€è¦ç»“åˆå…¶ä»–å› å­è¿‡æ»¤

### 3. æ•°æ®è´¨é‡
- å»ºè®®é…åˆå…¶ä»–æŒ‡æ ‡ä½¿ç”¨
- å¦‚ï¼šç»“åˆROEã€è¥æ”¶å¢é•¿ç‡ç­‰
- é¿å…å•ä¸€å› å­å†³ç­–

---

## ğŸ“ ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `factors/valuation/alpha_peg_basic.py` | ä¿®æ”¹åçš„ä¸»ç¨‹åº |
| `test_alpha_peg_negative_to_zero.py` | æµ‹è¯•è„šæœ¬ |
| `docs/factor/alpha_peg_negative_to_zero_guide.md` | æœ¬è¯´æ˜æ–‡æ¡£ |

---

## ğŸ”§ éªŒè¯æ–¹æ³•

### è¿è¡Œæµ‹è¯•
```bash
python3 test_alpha_peg_negative_to_zero.py
```

### é¢„æœŸè¾“å‡º
```
âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ä¿®æ”¹é€»è¾‘æ­£ç¡®ã€‚
```

---

## ğŸ“ é—®é¢˜åé¦ˆ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»ï¼š
- é¡¹ç›®ç»„: Alpha006
- æ—¥æœŸ: 2026-01-04

---

## ğŸ“– ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¿®æ”¹å†…å®¹ |
|------|------|----------|
| 1.0 | 2025-12-24 | åŸå§‹ç‰ˆæœ¬ï¼Œä¿ç•™è´Ÿå€¼ |
| 2.0 | 2026-01-04 | ä¿®æ”¹ç‰ˆï¼Œè´Ÿå€¼ç½®0 |

---

**æ€»ç»“**ï¼šæœ¬æ¬¡ä¿®æ”¹å°†alpha_pegå› å­çš„è´Ÿå€¼ç»Ÿä¸€è®¾ä¸º0ï¼Œç®€åŒ–äº†å› å­ä½¿ç”¨é€»è¾‘ï¼Œæé«˜äº†æ•°æ®çš„ä¸€è‡´æ€§å’Œå¯è§£é‡Šæ€§ã€‚
