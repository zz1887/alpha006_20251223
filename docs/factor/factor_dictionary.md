# 量化因子库 - 标准化因子字典

**版本**: v2.0
**更新日期**: 2025-12-30
**适用范围**: 量化选股策略开发、因子研究、团队协作
**维护团队**: 量化策略组

---

## 因子索引

| 因子名称 | 因子类型 | 所属模块 | 更新状态 |
|----------|----------|----------|----------|
| [alpha_pluse](#alpha_pluse) | 量能因子 | factors/volume/ | ✅ 标准化 |
| [alpha_peg](#alpha_peg) | 估值因子 | factors/valuation/ | ✅ 标准化 |
| [alpha_peg_industry_zscore](#alpha_peg_industry_zscore) | 估值因子 | factors/valuation/ | ✅ 标准化 |
| [alpha_010](#alpha_010) | 短周期价格趋势因子 | factors/price/ | ✅ 标准化 |
| [alpha_038](#alpha_038) | 价格强度因子 | factors/price/ | ✅ 标准化 |
| [alpha_120cq](#alpha_120cq) | 价格位置因子 | factors/price/ | ✅ 标准化 |
| [cr_qfq](#cr_qfq) | 动量因子 | factors/momentum/ | ✅ 标准化 |

---

## 详细因子定义

### alpha_pluse

| 维度 | 详细信息 |
|------|----------|
| **因子名称** | alpha_pluse |
| **因子类型** | 量能因子（Volume Factor） |
| **核心计算逻辑** | 20日内满足「交易量=14日均值的1.4-3.5倍」的交易日数量∈[2,4]则=1，否则=0 |
| **计算公式** | `alpha_pluse = 1 if count_20d ∈ [2,4] else 0`<br>`count_20d = sum(vol_t ∈ [1.4×mean_14d, 3.5×mean_14d] for t in T-19 to T)` |
| **数据来源** | 数据库表: `daily_kline`<br>字段: `ts_code`, `trade_date`, `vol` |
| **关键参数** | • 回溯窗口: 20日<br>• 均值周期: 14日<br>• 倍数范围: [1.4, 3.5]<br>• 满足数量: [2, 4] |
| **数据口径** | • 成交量单位: 手（原始数据）<br>• 复权: 不涉及<br>• 剔除: 停牌数据（vol=0）<br>• 缺失: 标注NaN |
| **异常值处理** | • 数据不足34日: 标注NaN<br>• 成交量为0: 不参与计算<br>• 极端放量: 不剔除（因子特性） |
| **取值范围** | • 离散值: 0 或 1<br>• 信号比例: 约50%（历史统计） |
| **因子含义** | 捕捉成交量温和异动的交易日特征，过滤无量僵尸股和过度放量股 |
| **适用场景** | • 短周期选股（5-20日）<br>• 量价共振策略<br>• 基础筛选层<br>• 剔除低流动性股票 |
| **注意事项** | • 需要至少34日历史数据<br>• 参数可调（保守/激进版本）<br>• 适合全市场选股 |
| **版本配置** | 标准版: [1.4, 3.5, 2-4]<br>保守版: [1.5, 3.0, 3-4]<br>激进版: [1.3, 4.0, 2-5] |

---

### alpha_peg

| 维度 | 详细信息 |
|------|----------|
| **因子名称** | alpha_peg（原始值） |
| **因子类型** | 估值成长因子（Valuation-Growth Factor） |
| **核心计算逻辑** | PE_TTM / 单季净利润同比增长率 |
| **计算公式** | `alpha_peg_raw = pe_ttm / dt_netprofit_yoy` |
| **数据来源** | • PE数据: `daily_basic`表，字段`pe_ttm`<br>• 财务数据: `fina_indicator`表，字段`dt_netprofit_yoy`<br>• 匹配规则: 按`trade_date`和`ts_code`关联 |
| **关键参数** | • 财务数据更新: `update_flag = '1'`<br>• 前向填充: 是<br>• 异常值处理: 3σ原则 |
| **数据口径** | • PE: TTM市盈率（日频）<br>• 增长率: 单季净利润同比增长（%）<br>• 财报时点: 最新一期财报（前向填充）<br>• 剔除: dt_netprofit_yoy ≤ 0 或 pe_ttm ≤ 0 |
| **异常值处理** | • dt_netprofit_yoy为0或负: 标注NaN<br>• pe_ttm为负或空: 标注NaN<br>• 财务数据缺失: 标注NaN |
| **取值范围** | • 浮点数: 可正可负<br>• 典型范围: [-100, 100]<br>• 极端值: 可能很大（负增长时） |
| **因子含义** | 衡量单位盈利增长所对应的估值水平，值越小表示估值越低或增长越快 |
| **适用场景** | • 估值选股（低PEG）<br>• 行业内比较<br>• 价值投资策略<br>• 长期持有 |
| **注意事项** | • 需要最新财报数据<br>• 负增长会导致负值<br>• 行业间差异大<br>• 需要行业标准化后跨行业比较 |
| **版本配置** | 基础版: 原始值<br>保守版: 异常值阈值2.5σ<br>激进版: 异常值阈值3.5σ |

---

### alpha_peg_industry_zscore

| 维度 | 详细信息 |
|------|----------|
| **因子名称** | alpha_peg_industry_zscore（行业标准化alpha_peg） |
| **因子类型** | 估值成长因子（标准化） |
| **核心计算逻辑** | 申万一级行业内Z-Score标准化 |
| **计算公式** | `alpha_peg_zscore = (alpha_peg_raw - industry_mean) / industry_std`<br>其中: industry_mean和industry_std按行业分组计算 |
| **数据来源** | • 原始alpha_peg: 同上<br>• 行业分类: `sw_industry`表，字段`l1_name`<br>• 匹配规则: 按`ts_code`关联 |
| **关键参数** | • 行业分类: 申万一级行业<br>• 标准化方法: Z-Score<br>• 行业样本阈值: ≥5只（否则标注NaN）<br>• 异常值: 已在原始值中处理 |
| **数据口径** | • 行业分组: 每个行业独立计算均值和标准差<br>• 跨行业可比: 是<br>• 缺失行业: 归类为"其他" |
| **异常值处理** | • 行业样本<5只: 标注NaN<br>• 行业标准差=0: 标注0<br>• 原始值缺失: 保持缺失 |
| **取值范围** | • 标准化浮点数<br>• 理论范围: 无限制<br>• 典型范围: [-3, 3]<br>• 均值≈0，标准差≈1 |
| **因子含义** | 消除行业偏差后的估值性价比，值越小表示相对行业越便宜 |
| **适用场景** | • 跨行业选股<br>• 行业中性策略<br>• 多行业轮动<br>• 全市场排名 |
| **注意事项** | • 依赖原始alpha_peg计算<br>• 行业分类必须准确<br>• 小行业需谨慎使用<br>• 适合全市场选股 |
| **版本配置** | 行业优化版: 使用行业特定阈值<br>Z-score版: 标准化输出<br>保守版: 2.5σ异常值处理 |

---

### alpha_010

| 维度 | 详细信息 |
|------|----------|
| **因子名称** | alpha_010 |
| **因子类型** | 短周期价格趋势因子（Short-term Price Trend Factor） |
| **核心计算逻辑** | 4日股价涨跌一致性特征，通过三元规则判断趋势方向并进行全市场排名 |
| **计算公式** | 1. 计算每日涨跌幅: `Δclose = close_t - close_{t-1}`<br>2. 统计4日Δclose的ts_min和ts_max<br>3. 三元规则取值:<br>　- 如果 `ts_min > 0`: 说明4日连续上涨，取 `Δclose`（正值）<br>　- 如果 `ts_max < 0`: 说明4日连续下跌，取 `Δclose`（负值）<br>　- 否则: 取 `-Δclose`（反转信号）<br>4. 全市场rank（从小到大）得到alpha_010 |
| **数据来源** | 数据库表: `daily_kline`<br>字段: `ts_code`, `trade_date`, `close` |
| **关键参数** | • 窗口: 4日<br>• 最小数据天数: 5日（4+1）<br>• 复权: 前复权<br>• 排名范围: 全市场 |
| **数据口径** | • 价格: 前复权close<br>• 涨跌幅: 当日-前日<br>• 统计窗口: 目标日前4个Δclose<br>• 排名: 升序排名（1=最小，N=最大） |
| **异常值处理** | • 数据不足5日: 标注NaN<br>• 目标日无数据: 标注NaN<br>• Δclose全为NaN: 标注NaN |
| **取值范围** | • 整数排名<br>• 理论范围: [1, N]，N=股票总数<br>• 实际范围: [1, 3736]（20251229统计）<br>• 均值≈N/2，标准差≈N/√12 |
| **因子含义** | 捕捉短周期（4日）股价涨跌的一致性特征：<br>• 连续上涨/下跌: 趋势延续信号<br>• 震荡反转: 趋势反转信号<br>值越大表示趋势越强或反转可能性越大 |
| **适用场景** | • 超短期选股（3-5日）<br>• 趋势跟踪策略<br>• 反转策略<br>• 量价配合验证 |
| **注意事项** | • 需要至少5日历史数据<br>• 窗口期短，对噪音敏感<br>• 适合与其他因子组合使用<br>• 三元规则确保方向一致性 |
| **版本配置** | 标准版: 4日窗口<br>保守版: 6日窗口（更严格）<br>激进版: 3日窗口（更敏感） |

---

### alpha_038

| 维度 | 详细信息 |
|------|----------|
| **因子名称** | alpha_038 |
| **因子类型** | 价格因子（Price Factor） |
| **核心计算逻辑** | 短期价格排名与当日涨跌幅的组合特征 |
| **计算公式** | `alpha_038 = (-1 × rank(Ts_Rank(close, 10))) × rank(close/open)`<br>其中:<br>• Ts_Rank(close, 10): 目标日close在10日序列中的排名(1=最小,10=最大)<br>• rank(close/open): 所有股票close/open比值的降序排名(1=最大) |
| **数据来源** | 数据库表: `daily_kline`<br>字段: `ts_code`, `trade_date`, `open`, `close` |
| **关键参数** | • 窗口: 10日<br>• 复权: 前复权（close/open）<br>• 排名范围: 全市场 |
| **数据口径** | • 价格: 前复权<br>• close/open: 目标日比值<br>• 排名: 降序排名（值越大排名越小）<br>• 剔除: 10日数据不足 |
| **异常值处理** | • 数据不足10日: 标注NaN<br>• open为0或NaN: 标注NaN<br>• 目标日无数据: 标注NaN |
| **取值范围** | • 整数乘积<br>• 理论范围: [-10×N, -1×1]，N=股票总数<br>• 实际范围: [-53760, -10]（20250919统计）<br>• 所有值均为负数 |
| **因子含义** | 结合10日价格相对位置和当日涨跌幅，捕捉短期强势特征。值越小（绝对值越大）表示动量越强 |
| **适用场景** | • 短期价格趋势选股<br>• 动量策略<br>• 价格突破确认<br>• 5-10日持有期 |
| **注意事项** | • 值域较大，建议标准化后使用<br>• 负值因子，越小越好<br>• 对极端close/open敏感<br>• 适合捕捉短期强势股 |
| **版本配置** | 标准版: 10日窗口<br>保守版: 15日窗口<br>激进版: 5日窗口 |

---

### alpha_120cq

| 维度 | 详细信息 |
|------|----------|
| **因子名称** | alpha_120cq |
| **因子类型** | 价格位置因子（Price Position Factor） |
| **核心计算逻辑** | 当日收盘价在120日有效交易日序列中的分位数 |
| **计算公式** | `alpha_120cq = (rank - 1) / (N - 1)`<br>其中:<br>• rank = 当日close在120日序列中的排名（1=最小，N=最大）<br>• N = 有效交易日数量（≤120） |
| **数据来源** | 数据库表: `daily_kline`<br>字段: `ts_code`, `trade_date`, `close` |
| **关键参数** | • 窗口: 120日<br>• 最小有效天数: 30日<br>• 复权: 前复权<br>• 排名: 升序（值越小排名越小） |
| **数据口径** | • 价格: 前复权close<br>• 窗口: 目标日往前120个有效交易日<br>• 有效定义: 有价格数据且>0<br>• 缺失: 剔除无效数据 |
| **异常值处理** | • 有效数据<30日: 标注NaN<br>• close≤0: 标注NaN<br>• 目标日无数据: 标注NaN |
| **取值范围** | • 连续浮点数<br>• 理论范围: [0, 1]<br>• 0: 历史最低价<br>• 0.5: 中位数<br>• 1: 历史最高价 |
| **因子含义** | 衡量股价在中期（约半年）时间维度的相对高低位置，值越大表示位置越高 |
| **适用场景** | • 中期价格位置选股<br>• 趋势反转策略<br>• 均值回归策略<br>• 20-60日持有期 |
| **注意事项** | • 需要120日历史数据<br>• 新股数据不足需剔除<br>• 适合中期投资<br>• 可结合趋势指标使用 |
| **版本配置** | 标准版: 120日窗口<br>保守版: 180日窗口<br>激进版: 60日窗口 |

---

### cr_qfq

| 维度 | 详细信息 |
|------|----------|
| **因子名称** | cr_qfq |
| **因子类型** | 价格动量因子（Price Momentum Factor） |
| **核心计算逻辑** | CR指标（N=20），基于前复权的HIGH/LOW/CLOSE计算 |
| **计算公式** | `CR = SUM(HIGH - REF(CLOSE, 1), N) / SUM(REF(CLOSE, 1) - LOW, N) × 100`<br>其中N=20，数据为前复权 |
| **数据来源** | 数据库表: `stk_factor_pro`<br>字段: `ts_code`, `trade_date`, `cr_qfq` |
| **关键参数** | • 周期N: 20日<br>• 复权: 前复权（_qfq后缀）<br>• 计算源: HIGH/LOW/CLOSE |
| **数据口径** | • 价格: 前复权<br>• 计算: 标准CR指标公式<br>• 预计算: 从因子表直接读取<br>• 缺失: 标注NaN |
| **异常值处理** | • 无数据: 标注NaN<br>• 极端值: 保留（因子特性） |
| **取值范围** | • 浮点数<br>• 理论范围: [0, +∞)<br>• 实际范围: [0, 3140.90]（20250919统计）<br>• 均值: 100.57 |
| **因子含义** | 衡量20日内多空力量对比，值越大表示多方力量越强，动量越强 |
| **适用场景** | • 动量策略<br>• 趋势跟踪<br>• 追涨策略<br>• 短中期持有 |
| **注意事项** | • 依赖预计算因子<br>• 需要前复权数据<br>• 值域跨度大<br>• 适合与其他因子组合 |
| **版本配置** | 标准版: N=20<br>保守版: N=30<br>激进版: N=10 |

---

## 因子组合策略

### 策略3（多因子叠加）

**公式**:
```
综合得分 = 0.20 × (1 - alpha_pluse) +          # 量能（反向）
           0.25 × (-alpha_peg_zscore) +         # 估值（负向）
           0.15 × alpha_120cq +                 # 位置（正向）
           0.20 × (cr_qfq / cr_qfq.max()) +     # 动量（标准化）
           0.20 × (-alpha_038 / alpha_038.min()) # 强度（负向）
```

**因子方向说明**:
- ✅ **正向因子**: 值越大越好（alpha_120cq, cr_qfq）
- ❌ **负向因子**: 值越小越好（alpha_pluse, alpha_peg, alpha_038）

**权重分配**:
- 量能: 20%
- 估值: 25%（权重最高）
- 位置: 15%
- 动量: 20%
- 强度: 20%

**适用场景**:
- 全市场选股
- 中短期持有（5-20日）
- 平衡型策略
- 多因子叠加验证

---

## 因子使用指南

### 1. 单因子使用

```python
# 示例: 使用alpha_peg_industry_zscore
from factors.valuation.alpha_peg import AlphaPEGFactor

# 创建因子计算器
factor = AlphaPEGFactor(params={
    'outlier_sigma': 3.0,
    'normalization': None,
    'industry_specific': True
})

# 计算因子
result = factor.calculate_by_period('20250901', '20250919')

# 选股: 每行业选前3名
selected = factor.select_top_n_by_industry(result, top_n=3)
```

### 2. 多因子组合

```python
# 示例: 策略3综合得分
from core.utils.data_processor import calculate_rank

# 1. 分别计算各因子
alpha_pluse = ...  # 量能因子
alpha_peg = ...    # 估值因子
alpha_120cq = ...  # 位置因子
cr_qfq = ...       # 动量因子
alpha_038 = ...    # 强度因子

# 2. 标准化
cr_qfq_norm = cr_qfq / cr_qfq.max()
alpha_038_norm = -alpha_038 / alpha_038.min()

# 3. 计算综合得分
df['综合得分'] = (
    0.20 * (1 - alpha_pluse) +
    0.25 * (-alpha_peg) +
    0.15 * alpha_120cq +
    0.20 * cr_qfq_norm +
    0.20 * alpha_038_norm
)

# 4. 排序选股
df = df.sort_values('综合得分', ascending=False)
top_stocks = df.head(100)
```

### 3. 参数优化建议

| 因子 | 保守策略 | 平衡策略 | 激进策略 |
|------|----------|----------|----------|
| alpha_pluse | [1.5, 3.0, 3-4] | [1.4, 3.5, 2-4] | [1.3, 4.0, 2-5] |
| alpha_peg | 2.5σ + 行业优化 | 3.0σ + 行业优化 | 3.5σ + 行业优化 |
| alpha_120cq | 180日窗口 | 120日窗口 | 60日窗口 |
| cr_qfq | N=30 | N=20 | N=10 |
| alpha_038 | 15日窗口 | 10日窗口 | 5日窗口 |

---

## 数据质量检查清单

### 计算前检查
- [ ] 数据库连接正常
- [ ] 目标日期有交易数据
- [ ] 财务数据最新日期 ≥ 目标日期
- [ ] 行业数据完整
- [ ] 因子表数据存在

### 计算中检查
- [ ] 有效数据比例 > 80%
- [ ] 异常值比例 < 5%
- [ ] 因子值分布合理
- [ ] 缺失原因已记录

### 计算后检查
- [ ] 因子值范围符合预期
- [ ] 统计特征（均值、标准差）合理
- [ ] 无大量极端值
- [ ] 输出文件格式正确

---

## 更新日志

### v2.0 (2025-12-30)
- ✅ 统一因子计算口径
- ✅ 补充异常处理细节
- ✅ 完善适用场景说明
- ✅ 添加参数配置建议
- ✅ 标准化文档格式
- ✅ 新增alpha_pluse、alpha_038、alpha_120cq、cr_qfq因子
- ✅ 新增alpha_010短周期价格趋势因子
- ✅ 新增策略3综合得分公式
- ✅ 因子库覆盖六大类: 量能、估值、短周期价格趋势、价格强度、价格位置、动量

### v1.0 (2025-12-24)
- 初始版本
- 包含alpha_peg因子定义

---

**维护团队**: 量化策略组
**更新频率**: 因子逻辑变更时及时更新
**文档状态**: ✅ 完成标准化

