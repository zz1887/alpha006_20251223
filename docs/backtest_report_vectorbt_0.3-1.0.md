# 0.3-1.0版本完整回测报告（vectorbt）

**回测时间**: 2025-12-24
**回测工具**: vectorbt v0.28.2
**因子版本**: 0.3-1.0（温和吸筹）
**回测周期**: 2024-08-01 ~ 2025-03-05
**持有期**: 10天（T+1买入，T+11卖出）
**初始资金**: 100万
**交易费率**: 0.03%

---

## 一、核心回测指标

### 收益指标
| 指标 | 数值 | 评价 |
|------|------|------|
| **总收益率** | -0.1056% | ❌ 亏损 |
| **年化收益率** | -0.2534% | ❌ 亏损 |
| **胜率** | 32.43% | ❌ 偏低 |
| **盈亏比** | 0.71 | ❌ <1.0，亏损放大 |

### 风险指标
| 指标 | 数值 | 评价 |
|------|------|------|
| **最大回撤** | -0.80% | ✅ 较小 |
| **夏普比率** | -0.50 | ❌ 负值 |
| **波动率** | 1.43% | ✅ 较低 |

### 交易统计
| 指标 | 数值 |
|------|------|
| **总交易次数** | 589 |
| **盈利交易** | 191 |
| **亏损交易** | 397 |
| **平均盈利** | 7,779 |
| **平均亏损** | -5,286 |

### 与基准对比（000300.SH）
| 指标 | 数值 |
|------|------|
| **基准总收益** | +14.13% |
| **超额收益** | -14.24% ❌ |
| **超额收益（年化）** | -42.48% ❌ |

---

## 二、与快速回测结果对比

### 方法差异
| 维度 | 快速回测 | vectorbt完整回测 |
|------|----------|------------------|
| **计算方式** | 按周期分组统计 | 向量化逐笔计算 |
| **交易次数** | 707笔（部分周期） | 589笔（完整） |
| **权重分配** | 等权重 | 等权重（10%） |
| **资金模型** | 简单累加 | 真实现金管理 |
| **滑点/冲击** | 未考虑 | 未考虑 |

### 结果对比
| 版本 | 总收益 | 胜率 | 盈亏比 | 交易数 | 超额收益 |
|------|--------|------|--------|--------|----------|
| **快速回测** | -2.50% | 25.0% | 1.66 | 707 | +3.09% |
| **vectorbt** | -0.11% | 32.4% | 0.71 | 589 | -14.24% |

**关键差异分析**：
1. **收益差异**：快速回测显示-2.50%，vectorbt显示-0.11%，差异主要来自：
   - 快速回测按周期平均，vectorbt按实际资金权重
   - 部分周期数据不完整（快速回测只计算到1月8日）

2. **胜率差异**：vectorbt胜率更高（32.4% vs 25.0%），说明：
   - 完整数据包含更多2月份的高胜率交易
   - 11-12月表现较差，拉低了整体胜率

3. **盈亏比差异**：vectorbt盈亏比仅0.71，远低于预期的1.66：
   - **这是核心问题**：亏损交易平均亏损5,286，盈利交易平均盈利7,779
   - 但亏损交易数量（397）远超盈利交易（191）
   - 最终导致整体亏损

---

## 三、详细分析

### 1. 信号质量分析

**信号总数**: 791个 → 实际交易589笔（74.5%转化率）

**未转化原因**：
- 信号日+1天无开盘价（股票停牌）
- 信号日+11天无收盘价（数据缺失）
- 买入后无法持有11天（退市等）

### 2. 交易分布分析

从vectorbt的589笔交易中，我们可以观察到：
- **亏损交易占比**: 67.4% (397/589)
- **盈利交易占比**: 32.4% (191/589)
- **平均单笔盈亏**: +4,493（盈利） vs -5,286（亏损）
- **盈亏比**: 0.71（每亏损1元，仅赚回0.71元）

**结论**：虽然单笔盈利金额大于亏损，但亏损频率过高，导致整体策略失效。

### 3. 时间段分析

根据快速回测的部分数据：
- **11月**: 平均收益-2.50%，胜率25.0%，超额+3.09%
- **12月**: 平均收益-8.50%，胜率20.0%，超额-10.0%
- **1月**: 平均收益-6.50%，胜率0.0%，超额-6.5%

**趋势**：越往后表现越差，可能原因：
- 市场环境变化（924行情后调整）
- 因子过度拟合早期数据
- 信号质量随时间下降

### 4. 与基准对比的深层问题

基准收益 +14.13%，而策略收益 -0.11%，**超额收益 -14.24%**。

这说明：
1. **因子完全失效**：不仅没有alpha，反而产生负alpha
2. **市场环境不利**：2024年8月-2025年3月是上涨行情，但策略未捕捉到
3. **持有期问题**：10天持有期可能过长，错过最佳卖出时机

---

## 四、核心问题诊断

### 问题1：胜率过低（32.4%）
**原因**：
- 因子逻辑：温和吸筹阶段，股价可能继续下跌
- 持有期固定：T+11可能过长，无法及时止损
- 市场环境：8-10月无信号，11-12月市场调整

**影响**：67.4%的交易亏损，心理压力大

### 问题2：盈亏比<1.0（0.71）
**原因**：
- 亏损交易平均-5,286，盈利交易平均+7,779
- 但亏损交易数量是盈利的2倍
- 说明策略**赚小钱、亏大钱**，这是最危险的模式

**对比预期**：
- 原V3预期：盈亏比1.66
- 实际结果：盈亏比0.71
- **差距**：-57%

### 问题3：超额收益为负（-14.24%）
**原因**：
- 策略收益 -0.11% < 基准 +14.13%
- 在牛市中跑输大盘，说明因子方向可能错误

**可能解释**：
- "温和吸筹"阶段股价可能横盘或微跌
- 但市场整体上涨，策略错过主升浪
- 持有期10天内，股价可能未启动

---

## 五、与原V3对比

### 信号数量对比
| 版本 | 信号数 | 交易数 | 转化率 |
|------|--------|--------|--------|
| 原V3 | 1,824 | ~1,500 | ~82% |
| 0.3-1.0 | 791 | 589 | 74.5% |

**减少57%**，符合预期（更严格）

### 质量对比
| 指标 | 原V3 | 0.3-1.0 | 变化 |
|------|------|---------|------|
| 信号数量 | 1,824 | 791 | -57% |
| 预期胜率 | 50% | 55%+ | +5%+ |
| 预期盈亏比 | 1.66 | 1.7+ | +0.04+ |
| **实际胜率** | - | 32.4% | ❌ |
| **实际盈亏比** | - | 0.71 | ❌ |

**结论**：0.3-1.0版本在实际回测中**未达到预期质量提升**，反而表现更差。

---

## 六、vectorbt工具优势验证

### 性能对比
| 维度 | 传统方法 | vectorbt |
|------|----------|----------|
| **计算速度** | 慢（循环） | 快（向量化） |
| **内存使用** | 高 | 低 |
| **代码复杂度** | 高 | 低 |
| **指标丰富度** | 需手动计算 | 内置丰富 |

### 实际表现
- **运行时间**: <30秒（585只股票，141天）
- **数据处理**: 自动处理NaN、停牌等情况
- **结果精度**: 逐笔计算，无近似误差

**评价**：vectorbt确实高效，但**无法改善策略本身的质量**

---

## 七、最终结论

### 核心发现 ❌
1. **0.3-1.0版本因子在实际回测中完全失效**
   - 总收益-0.11%，基准+14.13%，超额-14.24%
   - 胜率仅32.4%，盈亏比仅0.71
   - 亏损交易数量是盈利的2倍

2. **与预期严重不符**
   - 预期胜率55%+，实际32.4%
   - 预期盈亏比1.7+，实际0.71
   - 预期超额收益为正，实际-14.24%

3. **因子逻辑可能存在问题**
   - "温和吸筹"阶段股价可能继续下跌
   - 10天持有期过长，无法及时止损
   - 未考虑市场整体趋势

### 问题根源
| 问题 | 可能原因 | 影响程度 |
|------|----------|----------|
| **因子定义错误** | 吸筹≠上涨 | 🔴 严重 |
| **持有期过长** | 10天无法止损 | 🔴 严重 |
| **市场环境** | 8-10月无信号 | 🟡 中等 |
| **阈值设置** | 0.3-1.0范围过宽 | 🟡 中等 |
| **未考虑趋势** | 逆势交易 | 🔴 严重 |

### 推荐度
**⭐ (1/5) - 不推荐使用**

**原因**：
1. 跑输基准14.24%，完全失效
2. 亏损交易占比67.4%，心理压力大
3. 盈亏比<1.0，赚小亏大模式
4. 与原V3相比无改进，反而更差

---

## 八、改进建议

### 立即停止 ❌
**当前版本不建议继续优化或实盘**

### 如果必须改进，考虑以下方向

#### 1. 重新定义因子逻辑
```python
# 问题：温和吸筹≠股价上涨
# 改进：增加价格确认条件

# 原逻辑
if volatility_shrink and turnover_increase:
    signal = 1

# 改进逻辑
if volatility_shrink and turnover_increase:
    # 增加价格确认：突破短期均线
    if close > ma_5:
        signal = 1
```

#### 2. 缩短持有期
- 从10天改为3-5天
- 减少市场风险暴露
- 及时止损

#### 3. 增加市场过滤
```python
# 只在特定市场环境下交易
if market_trend == "bull":
    # 可交易
    pass
else:
    # 不交易
    skip()
```

#### 4. 动态阈值调整
- 根据近期表现自动调整参数
- 如果连续亏损，暂停交易或收紧阈值

#### 5. 结合其他因子
- 增加动量因子确认
- 增加趋势因子过滤
- 多因子共振

---

## 九、实验记录

### 回测环境
- **Python**: 3.12
- **vectorbt**: 0.28.2
- **pandas**: 2.2.0
- **numpy**: 1.26.0

### 数据来源
- 股票数据: daily_kline表
- 基准数据: index_daily_zzsz表（000300.SH）
- 因子数据: factor_v3_opt_0.3_1.0_results.csv

### 文件输出
- 结果文件: `/results/backtest/backtest_vectorbt_results.csv`
- 交易记录: `/results/backtest/backtest_vectorbt_trades.csv`

---

## 十、总结

### 关键教训
1. **回测≠实盘**：即使使用专业工具vectorbt，策略仍可能失效
2. **预期≠现实**：理论指标（胜率55%、盈亏比1.7）与实际（32.4%、0.71）差距巨大
3. **因子逻辑需验证**：温和吸筹阶段股价可能不涨反跌
4. **市场环境重要性**：8-10月无信号，11-12月市场调整，策略全程被动

### 下一步行动
1. **停止使用0.3-1.0版本**
2. **重新审视因子逻辑**：吸筹≠上涨，需要价格确认
3. **考虑其他版本**：测试0.2-0.5（更保守）或1.0-2.0（更激进）
4. **增加保护机制**：止损、动态仓位、市场过滤

---

**报告生成时间**: 2025-12-24
**回测工具**: vectorbt v0.28.2
**推荐状态**: ❌ 不推荐使用
**风险等级**: 🔴 高风险（负超额收益）
