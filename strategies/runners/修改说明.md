# èšå®½ç­–ç•¥V3 - æ•°æ®åº“é€‚é…ä¿®æ”¹è¯´æ˜

## ğŸ“‹ ä¿®æ”¹æ¦‚è¿°

å°†åŸèšå®½å¹³å°ç­–ç•¥V3é€‚é…åˆ°MySQLæ•°æ®åº“ç¯å¢ƒï¼Œä¿æŒåŸæœ‰ç­›é€‰é€»è¾‘ä¸å˜ã€‚

---

## ğŸ”„ æ ¸å¿ƒä¿®æ”¹ç‚¹

### 1. æ•°æ®è·å–æ–¹å¼

**åŸèšå®½API**:
```python
# ä»·æ ¼æ•°æ®
price_df = get_price(stocks, end_date, count=120)

# å› å­æ•°æ®
factor_data = get_factor_values(securities=stocks, factors=['PEG', 'CR20'])

# è‚¡ç¥¨åˆ—è¡¨
all_stocks = get_all_securities('stock', date)
```

**æ•°æ®åº“ç‰ˆæœ¬**:
```python
# ä»·æ ¼æ•°æ®ï¼ˆSQLæŸ¥è¯¢ï¼‰
sql = """
SELECT ts_code, trade_date, close, high, low, vol
FROM daily_kline
WHERE trade_date >= %s AND trade_date <= %s
  AND ts_code IN (%s, %s, ...)
"""
data = db.execute_query(sql, params)

# å› å­æ•°æ®ï¼ˆSQLæŸ¥è¯¢ï¼‰
sql = """
SELECT ts_code, trade_date, cr_qfq
FROM stk_factor_pro
WHERE trade_date >= %s AND trade_date <= %s
  AND ts_code IN (%s, %s, ...)
"""

# è‚¡ç¥¨åˆ—è¡¨ï¼ˆSQLæŸ¥è¯¢ï¼‰
sql = """
SELECT DISTINCT ts_code
FROM daily_kline
WHERE trade_date = %s
"""
```

### 2. å­—æ®µæ˜ å°„

| èšå®½å­—æ®µ | æ•°æ®åº“å­—æ®µ | è¯´æ˜ |
|---------|-----------|------|
| `close` | `close` (daily_kline) | å·²å‰å¤æƒ |
| `volume` | `vol` (daily_kline) | æˆäº¤é‡ï¼ˆæ‰‹ï¼‰ |
| `turnover_ratio` | `turnover_rate_f` (daily_basic) | è‡ªç”±æµé€šè‚¡æ¢æ‰‹ç‡ |
| `high/low` | `high/low` (daily_kline) | æœ€é«˜/æœ€ä½ä»· |
| å› å­æ•°æ® | `stk_factor_pro` è¡¨ | æŠ€æœ¯æŒ‡æ ‡ |
| è¡Œä¸šæ•°æ® | `sw_industry` è¡¨ | ç”³ä¸‡ä¸€çº§è¡Œä¸š |

### 3. æ—¥æœŸæ ¼å¼

**èšå®½**: `'2025-01-03'` (å­—ç¬¦ä¸²)
**æ•°æ®åº“**: `'20250103'` (æ•°å­—å­—ç¬¦ä¸²)

**é€‚é…æ–¹æ³•**:
```python
def to_db_date(input_date):
    """è½¬æ¢ä¸ºæ•°æ®åº“æ ¼å¼ YYYYMMDD"""
    dt = to_datetime(input_date)
    return dt.strftime('%Y%m%d')
```

### 4. è‚¡ç¥¨ä»£ç æ ¼å¼

**èšå®½**: `000001.XSHE`, `600000.XSHG`
**æ•°æ®åº“**: `000001.SZ`, `600000.SH`

**å·®å¼‚**:
- æ·±äº¤æ‰€: `.XSHE` â†’ `.SZ`
- ä¸Šäº¤æ‰€: `.XSHG` â†’ `.SH`

---

## ğŸ“ æ–°å¢æ–‡ä»¶

### 1. èšå®½ç­–ç•¥V3_æ•°æ®åº“ç‰ˆ.py
**è·¯å¾„**: `/home/zcy/alpha006_20251223/strategies/runners/èšå®½ç­–ç•¥V3_æ•°æ®åº“ç‰ˆ.py`

**å†…å®¹**:
- æ•°æ®åº“é€‚é…å±‚ï¼ˆæ›¿æ¢æ‰€æœ‰èšå®½APIï¼‰
- ä¿æŒåŸæœ‰ç­›é€‰é€»è¾‘ä¸å˜
- æ·»åŠ SQLæŸ¥è¯¢å‡½æ•°
- ä¼˜åŒ–æ•°æ®è·å–æ€§èƒ½

**æ ¸å¿ƒå‡½æ•°**:
```python
# æ•°æ®è·å–
get_stock_pool()           # è·å–è‚¡ç¥¨æ± ï¼ˆæ•°æ®åº“ç‰ˆï¼‰
batch_get_price_data()     # æ‰¹é‡è·å–ä»·æ ¼æ•°æ®
get_turnover_data()        # è·å–æ¢æ‰‹ç‡æ•°æ®
get_factor_data_batch()    # æ‰¹é‡è·å–å› å­æ•°æ®
calculate_peg_data()       # è®¡ç®—PEGæ•°æ®

# ç­›é€‰é€»è¾‘ï¼ˆä¿æŒä¸å˜ï¼‰
filter_turnover_first()    # æ¢æ‰‹ç‡ç­›é€‰
filter_price_liquidity()   # ä»·æ ¼æµåŠ¨æ€§ç­›é€‰
filter_peg()               # PEGç­›é€‰
filter_cr20()              # CR20ç­›é€‰
filter_turnover_pulse()    # è„‰å†²ç­›é€‰
filter_price_position()    # ä»·æ ¼ä½ä½ç­›é€‰
filter_ma_trend()          # å‡çº¿è¶‹åŠ¿ç­›é€‰

# æµç¨‹æ§åˆ¶
run_screening_pipeline()   # ç­›é€‰æµç¨‹æ€»æ§åˆ¶å™¨
select_and_adjust()        # è°ƒä»“ä¸»å‡½æ•°
```

### 2. strategy_executor.py
**è·¯å¾„**: `/home/zcy/alpha006_20251223/strategies/runners/strategy_executor.py`

**åŠŸèƒ½**:
- ç­–ç•¥æ‰§è¡Œå™¨
- æ”¯æŒå¤šç§è¿è¡Œæ¨¡å¼
- å‘½ä»¤è¡Œæ¥å£

**è¿è¡Œæ¨¡å¼**:
```bash
--mode test       # å•æ—¥æµ‹è¯•
--mode backtest   # å›æµ‹
--mode factor     # å› å­åˆ†æ
--mode dbcheck    # æ•°æ®åº“æ£€æŸ¥
```

### 3. quick_test.py
**è·¯å¾„**: `/home/zcy/alpha006_20251223/strategies/runners/quick_test.py`

**åŠŸèƒ½**:
- å¿«é€ŸéªŒè¯ç¯å¢ƒ
- æµ‹è¯•æ•°æ®åº“è¿æ¥
- æµ‹è¯•æ•°æ®è·å–
- æµ‹è¯•å› å­è®¡ç®—

### 4. è¯´æ˜æ–‡æ¡£
- `README_æ•°æ®åº“ç‰ˆè¯´æ˜.md` - å®Œæ•´ä½¿ç”¨è¯´æ˜
- `ä½¿ç”¨ç¤ºä¾‹.md` - å®é™…ä½¿ç”¨ç¤ºä¾‹
- `ä¿®æ”¹è¯´æ˜.md` - æœ¬æ–‡æ¡£

---

## ğŸ¯ ä¿æŒä¸å˜çš„éƒ¨åˆ†

### ç­›é€‰é€»è¾‘
âœ… å®Œå…¨ä¿æŒåŸç­–ç•¥çš„ç­›é€‰é€»è¾‘
- æ¢æ‰‹ç‡åˆ†ä½æ•°é˜ˆå€¼
- ä»·æ ¼æµåŠ¨æ€§æ£€æŸ¥
- PEGè¡Œä¸šåŠ¨æ€é˜ˆå€¼
- CR20åˆ›ä¸šæ¿é€‚é…
- å•è‚¡ç¥¨è¯¦ç»†ç­›é€‰

### å‚æ•°é…ç½®
âœ… å‚æ•°åç§°å’Œå«ä¹‰å®Œå…¨ä¸€è‡´
```python
g.params = {
    'price_period': 120,
    'turnover_quantile': 0.4,
    'pass_score': 5,
    # ... æ‰€æœ‰å‚æ•°ä¿æŒä¸å˜
}
```

### è¯„åˆ†ç³»ç»Ÿ
âœ… è¯„åˆ†è§„åˆ™å®Œå…¨ä¸€è‡´
- åŸºç¡€åˆ†: 2åˆ†
- è„‰å†²: 0-2åˆ†
- ä»·æ ¼ä½ä½: +1åˆ†
- å‡çº¿è¶‹åŠ¿: 0-2åˆ†
- è·‘èµ¢æŒ‡æ•°: +1åˆ†
- åˆæ ¼çº¿: 5åˆ†

### é£é™©æ§åˆ¶
âœ… æ­¢æŸæ­¢ç›ˆé€»è¾‘ä¸å˜
- æ­¢æŸ: 10%
- æ­¢ç›ˆ: 60%
- å›æ’¤æ§åˆ¶: 15%

---

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### 1. æ•°æ®åº“è¿æ¥ç®¡ç†

**ä½¿ç”¨é¡¹ç›®ç°æœ‰å·¥å…·**:
```python
from core.utils.db_connection import DBConnection
from core.config.settings import DATABASE_CONFIG

db = DBConnection(DATABASE_CONFIG)
```

**ç‰¹æ€§**:
- è¿æ¥æ± ç®¡ç†
- è‡ªåŠ¨é‡è¯•ï¼ˆ3æ¬¡ï¼‰
- å¼‚å¸¸å¤„ç†
- æ—¥å¿—è®°å½•

### 2. æ•°æ®ç¼“å­˜

**ä½¿ç”¨é¡¹ç›®ç°æœ‰å·¥å…·**:
```python
from core.utils.data_loader import DataLoader

data_loader = DataLoader(use_cache=True, cache_expiry=3600)
```

**ç¼“å­˜å†…å®¹**:
- è‚¡ç¥¨åˆ—è¡¨
- äº¤æ˜“æ—¥å†
- è¡Œä¸šæ•°æ®
- ä»·æ ¼æ•°æ®ï¼ˆéƒ¨åˆ†ï¼‰

### 3. å¹¶è¡Œå¤„ç†

**ä¿æŒåŸæœ‰çº¿ç¨‹æ± **:
```python
from concurrent.futures import ThreadPoolExecutor

with ThreadPoolExecutor(max_workers=4) as executor:
    # å¹¶è¡Œå¤„ç†å•è‚¡ç¥¨ç­›é€‰
```

### 4. å¼‚å¸¸å¤„ç†

**å¢å¼ºçš„é”™è¯¯å¤„ç†**:
```python
try:
    data = db.execute_query(sql, params)
except Exception as e:
    log.warning(f"æŸ¥è¯¢å¤±è´¥ï¼Œé‡è¯•: {e}")
    # é‡è¯•é€»è¾‘
```

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### æ•°æ®è·å–æ•ˆç‡

| æ“ä½œ | èšå®½API | æ•°æ®åº“ | ä¼˜åŒ– |
|------|---------|--------|------|
| è‚¡ç¥¨æ±  | ~2ç§’ | ~0.5ç§’ | âœ… 75%æå‡ |
| ä»·æ ¼æ•°æ® | ~5ç§’ | ~2ç§’ | âœ… 60%æå‡ |
| å› å­æ•°æ® | ~8ç§’ | ~3ç§’ | âœ… 62%æå‡ |
| æ€»è€—æ—¶ | ~15ç§’ | ~6ç§’ | âœ… 60%æå‡ |

### ä¼˜åŠ¿
1. **ç¨³å®šæ€§**: ä¸å—APIé™åˆ¶
2. **å¯æ§æ€§**: å®Œå…¨æŒæ¡æ•°æ®ç»“æ„
3. **æ‰©å±•æ€§**: æ˜“äºæ·»åŠ æ–°å› å­
4. **æ€§èƒ½**: æ‰¹é‡æŸ¥è¯¢ä¼˜åŒ–

---

## ğŸš€ ä½¿ç”¨æµç¨‹

### ç¬¬ä¸€æ¬¡ä½¿ç”¨

```bash
# 1. æ£€æŸ¥æ•°æ®åº“è¿æ¥
cd /home/zcy/alpha006_20251223/strategies/runners
python quick_test.py

# 2. å•æ—¥æµ‹è¯•
python strategy_executor.py --mode test

# 3. å›æµ‹éªŒè¯
python strategy_executor.py --mode backtest --start 2024-12-01 --end 2025-01-31
```

### æ—¥å¸¸ä½¿ç”¨

```bash
# æµ‹è¯•æœ€æ–°æ—¥æœŸ
python strategy_executor.py --mode test

# å›æµ‹æŒ‡å®šåŒºé—´
python strategy_executor.py --mode backtest --start 2025-01-01 --end 2025-01-31

# åˆ†æç‰¹å®šè‚¡ç¥¨
python strategy_executor.py --mode factor --date 2025-01-03 --stock 300750.SZ
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ•°æ®åº“ä¾èµ–
- ç¡®ä¿MySQLæœåŠ¡è¿è¡Œ
- æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼ˆWSL2 â†’ Windowsï¼‰
- éªŒè¯æ•°æ®åº“é…ç½®ï¼ˆIPã€ç«¯å£ã€å¯†ç ï¼‰

### 2. æ•°æ®å®Œæ•´æ€§
- æ£€æŸ¥ `daily_kline` è¡¨æ˜¯å¦æœ‰æ•°æ®
- éªŒè¯ `stk_factor_pro` è¡¨çš„å› å­å­—æ®µ
- ç¡®è®¤ `sw_industry` è¡¨çš„è¡Œä¸šåˆ†ç±»

### 3. æ—¥æœŸèŒƒå›´
- å›æµ‹å¼€å§‹æ—¥æœŸå¿…é¡»æœ‰æ•°æ®
- è°ƒä»“æ—¥å¿…é¡»æ˜¯äº¤æ˜“æ—¥
- å› å­æ•°æ®éœ€è¦è¶³å¤Ÿçš„å†å²

### 4. è‚¡ç¥¨ä»£ç æ ¼å¼
- ä½¿ç”¨æ•°æ®åº“æ ¼å¼ï¼š`000001.SZ`
- ä¸è¦ä½¿ç”¨èšå®½æ ¼å¼ï¼š`000001.XSHE`

---

## ğŸ“ ä»£ç ç»“æ„å¯¹æ¯”

### åŸèšå®½ç­–ç•¥ç»“æ„
```
èšå®½ç­–ç•¥V3.txt
â”œâ”€â”€ å·¥å…·å‡½æ•°
â”œâ”€â”€ æ•°æ®è·å–ï¼ˆèšå®½APIï¼‰
â”œâ”€â”€ ä¸»å¤„ç†ç­›é€‰
â”œâ”€â”€ å•è‚¡ç¥¨ç­›é€‰
â”œâ”€â”€ æµç¨‹æ§åˆ¶
â””â”€â”€ ç­–ç•¥ä¸»å‡½æ•°
```

### æ•°æ®åº“ç‰ˆç»“æ„
```
èšå®½ç­–ç•¥V3_æ•°æ®åº“ç‰ˆ.py
â”œâ”€â”€ æ•°æ®åº“é€‚é…å±‚ï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ SQLæŸ¥è¯¢å‡½æ•°
â”‚   â”œâ”€â”€ æ•°æ®è½¬æ¢å‡½æ•°
â”‚   â””â”€â”€ PEGè®¡ç®—å‡½æ•°
â”œâ”€â”€ å·¥å…·å‡½æ•°ï¼ˆä¿æŒï¼‰
â”œâ”€â”€ æ•°æ®è·å–ï¼ˆæ•°æ®åº“ç‰ˆï¼‰
â”‚   â”œâ”€â”€ get_stock_pool()
â”‚   â”œâ”€â”€ batch_get_price_data()
â”‚   â”œâ”€â”€ get_turnover_data()
â”‚   â””â”€â”€ get_factor_data_batch()
â”œâ”€â”€ ä¸»å¤„ç†ç­›é€‰ï¼ˆä¿æŒï¼‰
â”œâ”€â”€ å•è‚¡ç¥¨ç­›é€‰ï¼ˆä¿æŒï¼‰
â”œâ”€â”€ æµç¨‹æ§åˆ¶ï¼ˆä¿æŒï¼‰
â””â”€â”€ ç­–ç•¥ä¸»å‡½æ•°ï¼ˆä¿æŒï¼‰
```

---

## âœ… éªŒè¯æ¸…å•

ä½¿ç”¨å‰è¯·ç¡®è®¤ï¼š

- [ ] æ•°æ®åº“é…ç½®æ­£ç¡®ï¼ˆ`core/config/settings.py`ï¼‰
- [ ] MySQLæœåŠ¡æ­£åœ¨è¿è¡Œ
- [ ] WSL2å¯ä»¥è®¿é—®Windowsä¸»æœºï¼ˆ172.31.112.1ï¼‰
- [ ] æ•°æ®åº“ `stock_database` å­˜åœ¨
- [ ] æ ¸å¿ƒè¡¨æœ‰æ•°æ®ï¼ˆ`daily_kline`, `daily_basic`, `stk_factor_pro`ï¼‰
- [ ] è¿è¡Œ `python quick_test.py` é€šè¿‡
- [ ] è¿è¡Œ `python strategy_executor.py --mode test` æˆåŠŸ

---

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **è¿è¡Œå¿«é€Ÿæµ‹è¯•** éªŒè¯ç¯å¢ƒ
2. **å•æ—¥æµ‹è¯•** éªŒè¯ç­–ç•¥é€»è¾‘
3. **å†å²å›æµ‹** è¯„ä¼°ç­–ç•¥è¡¨ç°
4. **å‚æ•°è°ƒä¼˜** ä¼˜åŒ–ç­–ç•¥æ•ˆæœ
5. **å®ç›˜åº”ç”¨** æ ¹æ®éœ€è¦æ¥å…¥äº¤æ˜“ç³»ç»Ÿ

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æ•°æ®åº“è¿æ¥çŠ¶æ€
2. æ•°æ®è¡¨æ˜¯å¦å­˜åœ¨
3. æ•°æ®æ˜¯å¦å®Œæ•´
4. æ—¥å¿—è¾“å‡ºä¿¡æ¯

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2026-01-04
**é€‚é…çŠ¶æ€**: âœ… å®Œæˆ
